
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Sage Development Process &mdash; Sage Developer&#39;s Guide v1.0</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v1.0" href="index.html" />
    <link rel="next" title="Setting Up Git" href="git_setup.html" />
    <link rel="prev" title="Welcome to the Sage Developer’s Guide!" href="index.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="git_setup.html" title="Setting Up Git"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to the Sage Developer’s Guide!"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sage-development-process">
<span id="chapter-walk-through"></span><h1>Sage Development Process<a class="headerlink" href="#sage-development-process" title="Permalink to this headline">¶</a></h1>
<p>This section is a concise overview of the Sage development process. In
it, we will see how to make changes to the Sage source code and
communicate these changes back to the Sage project. If you are a
beginner to Sage development, this introductory guide is here to help
you become familiar with the Sage development process.</p>
<p>Sage comes with a set of developer scripts, which help you with common
interactions with the bug tracker (see <a class="reference internal" href="trac.html#chapter-sage-trac"><em>The Sage Trac Server</em></a>) and
with handling revisions of your code. The developer scripts use the
git distributed revison control system under the hood which you&#8217;ll
have to install (see <a class="reference internal" href="git_setup.html#chapter-git-setup"><em>Setting Up Git</em></a>), but you do not need to
know anything about it (see <a class="reference internal" href="manual_git.html#chapter-manual-git"><em>Git the Hard Way</em></a> only if you want
to).</p>
<p>Most of the commands in the following section will not work unless you have an
account on the bug tracker. If you want to contribute to Sage, it is a good
idea to get an account now (see <a class="reference internal" href="trac.html#section-trac-account"><em>Obtaining an Account</em></a>).</p>
<p>We assume here that the <tt class="docutils literal"><span class="pre">sage</span></tt> executable of your development
installation of Sage is in your <tt class="docutils literal"><span class="pre">PATH</span></tt>. If this is not the case, you
might have to replace <tt class="docutils literal"><span class="pre">sage</span></tt> by <tt class="docutils literal"><span class="pre">./sage</span></tt> or <tt class="docutils literal"><span class="pre">/path/to/sage</span></tt> in
the following. You can also use the developer scripts from the Sage
prompt. All commandline options to <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-dev</span></tt> are also available as
methods of the <tt class="docutils literal"><span class="pre">dev</span></tt> object in a Sage session. That is, for example,
to checkout a ticktet you can either run:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev checkout --ticket 1729
On ticket #1729 with associated local branch "ticket/1729".

#  Use "sage --dev merge" to include another ticket/branch.
#  Use "sage --dev commit" to save changes into a new commit.</pre>
</div>
<p>in a terminal or, equivalently, within Sage:</p>
<div class="highlight-python"><pre>sage: dev.checkout(1729)
On ticket #1729 with associated local branch "ticket/1729".

#  Use "dev.merge()" to include another ticket/branch.
#  Use "dev.commit()" to save changes in a new commit.</pre>
</div>
<p>Note that the number sign <tt class="docutils literal"><span class="pre">#</span></tt> (a.k.a. hash or pound sign) is the
comment marker for both the shell and Python. So if you were to input
<tt class="docutils literal"><span class="pre">#1729</span></tt>, it will be interpreted as the comment &#8220;1729&#8221; and not passed
to the development scripts. Always specify the ticket number as a
plain number, without the number sign in front.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>During the transitional period it can happen that you end up
on a branch where the developer scripts are not available or
outdated. If this is the case, i.e., if <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-dev</span></tt> does not
work properly anymore, run:</p>
<div class="highlight-python"><pre>git pull git://trac.sagemath.org/sage.git public/sage-git/master
sage -b</pre>
</div>
<p class="last">This will merge the latest version of the developer scripts
with your current branch. After rebuilding the Sage library,
the dev scripts should work again.</p>
</div>
<div class="section" id="contributing-to-the-sage-source-code">
<span id="section-walkthrough-add"></span><h2>Contributing to the Sage Source Code<a class="headerlink" href="#contributing-to-the-sage-source-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-ticket">
<span id="section-walkthrough-add-create"></span><h3>Create a Ticket<a class="headerlink" href="#create-a-ticket" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have written an algorithm for calculating the last twin prime, and
want to add it to Sage. You would first open a ticket for that:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev create-ticket</pre>
</div>
<p>This will give you an editor in which you can give a summary and a
description of what you want to do. If you are not sure which values
to put for the other fields, you can leave the defaults or have a look
at <a class="reference internal" href="trac.html#section-trac-fields"><em>The Ticket Fields</em></a>. After you close the editor, a new
ticket will be opened on the trac server. From that point on, everyone
can see what you intend to do which lets us avoid duplicating work. If
you want to cancel the creation of a ticket, then you can just save an
empty file. This will abort the operation.</p>
<p>Alternatively, you can use the <a class="reference external" href="http://trac.sagemath.org">web interface to the Sage trac
development server</a> to open a new ticket,
just log in and click on &#8220;Create Ticket&#8221;.</p>
</div>
<div class="section" id="editing-the-source-code">
<span id="section-walkthrough-add-edit"></span><h3>Editing the Source Code<a class="headerlink" href="#editing-the-source-code" title="Permalink to this headline">¶</a></h3>
<p>If you want to work on a ticket which you or somebody else created,
you first need to make a local &#8220;branch&#8221;. The development scripts
maintain a mapping between local branches and trac tickets. Creating a
new local branch for a ticket is easy:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev checkout --ticket 1729
On ticket #1729 with associated local branch "ticket/1729".

#  Use "sage --dev merge" to include another ticket/branch.
#  Use "sage --dev commit" to save changes into a new commit.</pre>
</div>
<p>Essentially, a branch is a copy (except that it doesn&#8217;t take up twice
the space) of the Sage source code where you can store your
modifications to the Sage source code and which you can upload to trac
tickets. Your new branch is now called <tt class="docutils literal"><span class="pre">ticket/&lt;TICKETNUM&gt;</span></tt>. Unless
you upload (&#8220;push&#8221;) it, see below, it will only be on your local
system and not visible to anyone else.</p>
<p>At this point you can start editing the source code. The subsequent
chapters of this developer guide explain how your code should look
like to fit into Sage, and how we ensure high code quality
throughout. Whenever you have reached one of your goals, you should
make a <em>commit</em>. This takes a snapshot of the whole Sage source code
that you have been working on and records the changes into your local
branch:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev commit
Commit your changes to branch "ticket/1729"? [Yes/no] y

#  Use "sage --dev push" to push your commits to the trac server once you are
#  done.</pre>
</div>
<p>You will be asked to write a message describing your changes. It is
common to write a one line summary, then a blank line, and then a 1-2
paragraph explanation of your changes. If your changes are minor, then
just the one-line summary can be enough.</p>
<p>If you are working on a larger project, it can be useful to break up
your work into multiple commits: Each commit is saved, enabling you to
retrieve older versions of files from the repository. So, even if you
accidentally delete something, you can get it back later. Also, if you
find a mistake in one of your earlier commits, then you just correct
it in the Sage source code and then add another commit on top.</p>
</div>
<div class="section" id="uploading-changes-to-trac">
<span id="section-walkthrough-add-push"></span><h3>Uploading Changes to Trac<a class="headerlink" href="#uploading-changes-to-trac" title="Permalink to this headline">¶</a></h3>
<p>At some point, you may wish to share your changes with the rest of us:
maybe it is ready for review, or maybe you are collaborating with
someone and want to share your changes &#8220;up until now&#8221;. This is simply
done by:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev push</pre>
</div>
<p>On trac, your remote branch will be called
<tt class="docutils literal"><span class="pre">u/&lt;USERNAME&gt;/ticket/&lt;TICKETNUM&gt;</span></tt>. This name will automatically be
added to the &#8220;Branch:&#8221; field on the ticket. Other developers then know
where to find your work in the git repository.</p>
<p>It is common to go through some iterations of <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-dev</span> <span class="pre">commit</span></tt>
before you upload, and you will probably also have uploaded a few
times before your changes are ready for review.</p>
<p>If you are happy with the changes you uploaded, you want somebody else
to review them, so they can be included into the next version of
Sage. If your ticket is ready for review, you should set it to
<tt class="docutils literal"><span class="pre">needs_review</span></tt> on the trac server. This can be done though the <a class="reference external" href="http://trac.sagemath.org">web
interface</a>, or, alternatively, using the
development scripts. For the latter, run:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev edit-ticket</pre>
</div>
<p>This will give you an editor in which you can edit the ticket. Change the
status to:</p>
<div class="highlight-python"><pre>Status: needs_review</pre>
</div>
<p>And add yourself as an author for that ticket by inserting the following as the
first line:</p>
<div class="highlight-python"><pre>Authors: Your Real Name</pre>
</div>
<p>If you want to add an additional comment for potential reviewers, run:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev comment</pre>
</div>
</div>
<div class="section" id="starting-without-a-ticket">
<span id="section-walkthrough-add-local"></span><h3>Starting Without a Ticket<a class="headerlink" href="#starting-without-a-ticket" title="Permalink to this headline">¶</a></h3>
<p>You might not want to create a trac ticket for your changes. For
example, if you are only working on your own code or if you are making
experimental changes that you are likely to throw away if they do not
work out. In that case, you can also start a branch that only lives in
your local repository. To do this, you use checkout but specify a
branch name instead of the ticket number. For example, to create a new
branch <tt class="docutils literal"><span class="pre">my_branch</span></tt>, you would run:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev checkout --branch my_branch</pre>
</div>
<p>This is assuming that you do not already have a local branch called
<tt class="docutils literal"><span class="pre">my_branch</span></tt>. If that were the case, you would just switch to the
already-existing branch. Once on your branch, you can work with it as
described in <a class="reference internal" href="#section-walkthrough-add-edit"><em>Editing the Source Code</em></a>.</p>
<p>You can upload your local branch later to an existing ticket. This
works exactly like in the case where you started with a ticket, except
that you have to specify the ticket number. That is:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev push --ticket &lt;TICKETNUM&gt;</pre>
</div>
<p>where you have to replace <tt class="docutils literal"><span class="pre">&lt;TICKETNUM&gt;</span></tt> with the number of the trac
ticket.</p>
</div>
</div>
<div class="section" id="merging">
<span id="section-walkthrough-merge"></span><h2>Merging<a class="headerlink" href="#merging" title="Permalink to this headline">¶</a></h2>
<p>As soon as you are working on a bigger project that spans multiple
tickets you will want to base your work on branches that have not been
merged into Sage yet. This is natural in collaborative development,
and in fact you are very much encouraged to split your work into
logically different parts. Ideally, each part that is useful on its
own and and can be reviewed independently should be a different
ticket, instead of a huge patch bomb.</p>
<p>For this purpose, you can incorporate branches from other tickets (or
just other local branches) into your current branch. This is called
merging, and all it does is include commits from other branches into
your current branch. In particular, this is done when a new Sage
release is made: the finished tickets are merged with the Sage master
and the result is the next Sage version. Git is smart enough to not
merge commits twice. In particular, it is possible to merge two
branches, one of which had already merged the other branch.</p>
<p>The syntax for merging is easy. If the code that you want to
incorporate is on a trac ticket number <tt class="docutils literal"><span class="pre">&lt;TICKETNUM&gt;</span></tt>, use:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev merge --ticket &lt;TICKETNUM&gt;</pre>
</div>
<p>Optionally, you can add the merged ticket to the trac &#8220;Dependency:&#8221;
field. Note that the merged commits become part of the current branch,
regardless of whether they are noted on trac. Adding a dependency
implies that the dependency must be reviewed first. After the
dependency is reviewed, the commits that came from the dependency are
no longer listed in the output of <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-dev</span> <span class="pre">diff</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>You should avoid merging tickets both ways. Once ticket A merged
ticket B and ticket B merged ticket A, there is no way to
distinguish commits that were originally made in ticket A or in
ticket B. Effectively, merging both ways combines the branches and
makes individual review impossible. Effectively, you should never
merge unless one of the following holds:</p>
<ul class="last simple">
<li>Either two tickets conflict, then you have to merge one into the
other in order to resolve the merge conflict.</li>
<li>Or you definitely need a feature that has been developed as part
of another branch.</li>
</ul>
</div>
<p>A special case of merging is merging in the <tt class="docutils literal"><span class="pre">master</span></tt> branch. This
brings your local branch up to date with the newest Sage version. The
above warning against unnecessary merges still applies, though. Try to
do all of your development with the Sage version that you originally
started with. The only reason for merging in the master branch is if
you need a new feature or if your branch conflicts.</p>
</div>
<div class="section" id="reviewing">
<span id="section-walkthrough-review"></span><h2>Reviewing<a class="headerlink" href="#reviewing" title="Permalink to this headline">¶</a></h2>
<p>Now suppose you want to review the existing work on a ticket, such as the one
you created in the last section.  For definiteness, suppose you want to review
#12270. You would do that as follows:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev checkout --ticket 12270</pre>
</div>
<p>This command will download the branch on Trac in case you do not have any local
work on ticket 12270. (If you do, you may have to merge your changes; see
below). You can now test the ticket; you&#8217;ll probably want to call <tt class="docutils literal"><span class="pre">make</span></tt> or
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-b</span></tt> first to rebuild Sage with the changes. Another important
command is:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev diff</pre>
</div>
<p>which lists all souce code changes that are part of the current
branch. That is, it lists the changes from the current master to the
current branch. If the ticket were to be positively reviewed, this is
the code that will be added to Sage. Note that there is no way to
&#8220;exclude dependencies&#8221;, just as there is no guarantee that unreviewed
dependencies will become part of Sage. The best way to exclude
dependencies from the diff output is to review them. Once the
dependency becomes part of the master branch, they are automatically
removed.</p>
<p>Most likely, your will want to add a comment to the ticket as part of
your review:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev comment</pre>
</div>
<p>This will open a text editor in which you can type, and upload the
result to Trac.</p>
<p>It is also possible that you make some changes to the code as part of
your review. After you have done that, you can upload your changes
back to trac:</p>
<div class="highlight-python"><pre>[user@localhost]$ sage -dev commit
[user@localhost]$ sage -dev push</pre>
</div>
<p>This will update the ticket to now point to your branch, including
your changes. Your branch is based on the original author&#8217;s branch, so
s/he can easily incorporate your changes into his/her own branch (see
below).</p>
</div>
<div class="section" id="collaboration">
<span id="section-walkthrough-collaborate"></span><h2>Collaboration<a class="headerlink" href="#collaboration" title="Permalink to this headline">¶</a></h2>
<p>It is very easy to collaborate by just going through the above steps any number of times:</p>
<div class="highlight-python"><pre># developer 1
&lt;EDIT EDIT&gt;
sage -dev commit
sage -dev push

# developer 2
sage -dev pull
&lt;EDIT EDIT&gt;
sage -dev commit
sage -dev push

# developer 1
sage -dev pull
&lt;EDIT EDIT&gt;
sage -dev commit
sage -dev push
(etc)</pre>
</div>
<p>The obvious problem is when you both work on the same ticket simultaneously:</p>
<div class="highlight-python"><pre># developer 1
&lt;EDIT EDIT&gt;
sage -dev commit
sage -dev push

# developer 2
&lt;EDIT EDIT&gt;
sage -dev commit
sage -dev push
Changes not compatible with remote branch
u/&lt;developer1&gt;/ticket/12270; consider
downloading first. Are you sure you want to continue?</pre>
</div>
<p>Developer 2 should probably select <tt class="docutils literal"><span class="pre">No</span></tt>, and do as suggested:</p>
<div class="highlight-python"><pre>sage -dev pull</pre>
</div>
<p>This will try to merge the changes developer 1 made into the ones that
developer 2 made. The latter should check whether all seems okay, and
if so, upload the changes:</p>
<div class="highlight-python"><pre>sage -dev push   # works now</pre>
</div>
<p>It is possible that the changes cannot be automatically merged. In
that case, developer 2 will have to do some manual fixup after
downloading and before uploading:</p>
<div class="highlight-python"><pre>&lt;EDIT EDIT FOR FIXUP&gt;
sage -dev commit
sage -dev push</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Sage Development Process</a><ul>
<li><a class="reference internal" href="#contributing-to-the-sage-source-code">Contributing to the Sage Source Code</a><ul>
<li><a class="reference internal" href="#create-a-ticket">Create a Ticket</a></li>
<li><a class="reference internal" href="#editing-the-source-code">Editing the Source Code</a></li>
<li><a class="reference internal" href="#uploading-changes-to-trac">Uploading Changes to Trac</a></li>
<li><a class="reference internal" href="#starting-without-a-ticket">Starting Without a Ticket</a></li>
</ul>
</li>
<li><a class="reference internal" href="#merging">Merging</a></li>
<li><a class="reference internal" href="#reviewing">Reviewing</a></li>
<li><a class="reference internal" href="#collaboration">Collaboration</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="index.html"
                                  title="previous chapter">Welcome to the Sage Developer&#8217;s Guide!</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="git_setup.html"
                                  title="next chapter">Setting Up Git</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/walk_through.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="git_setup.html" title="Setting Up Git"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to the Sage Developer’s Guide!"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2013, The Sage Development Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;  
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');
    
    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });
    
    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();
    
    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };
    
    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });
    
    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>