
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Git the Hard Way &mdash; Sage Developer&#39;s Guide v1.0</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v1.0" href="index.html" />
    <link rel="next" title="Sage Notebook Developer Guide" href="sagenb/index.html" />
    <link rel="prev" title="Git Background" href="git_background.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sagenb/index.html" title="Sage Notebook Developer Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="git_background.html" title="Git Background"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="git-the-hard-way">
<span id="chapter-manual-git"></span><h1>Git the Hard Way<a class="headerlink" href="#git-the-hard-way" title="Permalink to this headline">¶</a></h1>
<p>For beginners to Sage development we recommend using the Sage
development scripts as explained in <a class="reference internal" href="walk_through.html#chapter-walk-through"><em>Sage Development Process</em></a>, which
simplify using git and the trac server. However, you can use git
directly to work on Sage if you want to take off the training
wheels. This chapter will tell you how to do so assuming some
basic familiarity with git.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For now, use the <tt class="docutils literal"><span class="pre">build_system</span></tt> branch instead of master. This
will be changed soon.</p>
</div>
<p>We assume that you have a copy of the Sage git repository, for example
by running:</p>
<div class="highlight-python"><pre>[user@localhost ~]$ git clone git://github.com/sagemath/sage.git -b build_system
[user@localhost ~]$ cd sage
[user@localhost sage]$ make</pre>
</div>
<div class="section" id="branching-out">
<h2>Branching Out<a class="headerlink" href="#branching-out" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">create branches, switch between branches</p>
</div>
</div>
<div class="section" id="the-trac-server">
<h2>The Trac Server<a class="headerlink" href="#the-trac-server" title="Permalink to this headline">¶</a></h2>
<p>The Sage trac server also hold a copy of the Sage repository, it is
served via ssh but at the non-standard port 2222. To add it as a
remote repository to your local git repository, use the command:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git remote add trac ssh://git@trac.sagemath.org:2222/sage.git -t master
[user@localhost sage]$ git remote -v
origin      git://github.com/sagemath/sage.git (fetch)
origin      git://github.com/sagemath/sage.git (push)
trac        ssh://git@trac.sagemath.org:2222/sage.git (fetch)
trac        ssh://git@trac.sagemath.org:2222/sage.git (push)</pre>
</div>
<p>Instead of <tt class="docutils literal"><span class="pre">trac</span></tt> you can use any local name you want, of course. It
is perfectly fine to have multiple remote repositories for git, think
of them as bookmarks. You can then use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt> to get changes and
<tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt> to upload your local changes using:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git &lt;push|pull&gt; trac [ARGS]</pre>
</div>
</div>
<div class="section" id="checking-out-tickets">
<h2>Checking Out Tickets<a class="headerlink" href="#checking-out-tickets" title="Permalink to this headline">¶</a></h2>
<p>Trac tickets that are finished or in the process of being worked on
can have a git branch attached to them. This is the &#8220;Branch:&#8221; field in
the ticket description. The branch name is generally of the form
<tt class="docutils literal"><span class="pre">u/user/description</span></tt>, where <tt class="docutils literal"><span class="pre">user</span></tt> is the name of the user who
made the branch and <tt class="docutils literal"><span class="pre">description</span></tt> is some free-form short
description (and can include further slashes).</p>
<p>If you want to work with the changes in that remote branch, you must
make a local copy. In particular, git has no concept of directly
working with the remote branch, the remotes are only bookmarks for
things that you can get from/to the remote server. Your local branch
can have a different name, for example:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git checkout -b my_branch trac/u/user/description
Branch my_branch set up to track remote branch u/user/description from trac by rebasing.
Switched to a new branch 'my_branch'</pre>
</div>
<p>creates a new branch in your local git repository named <tt class="docutils literal"><span class="pre">my_branch</span></tt>
and switches to it. It is based on the remote <tt class="docutils literal"><span class="pre">u/user/description</span></tt>,
so you start out with the same files as in that ticket. You can then
edit files and commit changes to your local branch.</p>
</div>
<div class="section" id="pushing-your-changes-to-a-ticket">
<h2>Pushing Your Changes to a Ticket<a class="headerlink" href="#pushing-your-changes-to-a-ticket" title="Permalink to this headline">¶</a></h2>
<p>To add your local branch to a trac ticket, you first have to upload it
to the Sage trac repository and then put its name into the &#8220;Branch:&#8221;
field on the trac ticket.</p>
<p>Having set up your SSH key as described in
<a class="reference internal" href="trac.html#section-trac-ssh-key"><em>Linking your Public Key to your Trac Account</em></a>, you have push permissions to branches of
the form <tt class="docutils literal"><span class="pre">u/user/*</span></tt> where <tt class="docutils literal"><span class="pre">user</span></tt> is your trac username and <tt class="docutils literal"><span class="pre">*</span></tt>
is a wildcard, that is, any valid git branch name. By default, you do
<em>not</em> have push permissions to other user&#8217;s branches or the Sage
master branch. To push your branch to trac use either:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git push --set-upstream trac my_branch:u/user/description</pre>
</div>
<p>if you started the branch yourself and do not follow any other branch,
or use:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git push my_branch:u/user/description</pre>
</div>
<p>if your branch already has an upstream branch. The remaining arguments
are</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">my_branch</span></tt> is the name of your local branch,</li>
<li><tt class="docutils literal"><span class="pre">user</span></tt> is your trac username,</li>
<li><tt class="docutils literal"><span class="pre">description</span></tt> is some (short but self-explanatory) description of
your branch.</li>
</ul>
<p>Then, in order to use this branch as the proposed change on a trac
ticket, just fill its name <tt class="docutils literal"><span class="pre">u/user/description</span></tt> into the &#8220;Branch:&#8221;
field of the ticket description.</p>
<p>The <tt class="docutils literal"><span class="pre">Branch</span></tt> field is color coded: red means there is an issue,
green means it will merge cleanly into <tt class="docutils literal"><span class="pre">master</span></tt>. If it is red, the
tooltip will tell you what is wrong.  If it is green, then it will
link to a diff of the changes against <tt class="docutils literal"><span class="pre">u/ohanar/build_system</span></tt>. (This
is temporary until [#14480](<a class="reference external" href="http://trac.sagemath.org/14480">http://trac.sagemath.org/14480</a>) is merged
into the <tt class="docutils literal"><span class="pre">master</span></tt> branch.)</p>
<p>The above git commands create a new remote branch. If you make any
further local edits, then you need a slight variation of the command
to push your changes (but not create a new remote branch). So assume
that you made some further changes to your local branch and committed
them. Then you just have to push a certain commit, either specified by
its hex number or by the abbreviation <tt class="docutils literal"><span class="pre">HEAD</span></tt> for the most recent
one:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git push trac HEAD:u/user/description</pre>
</div>
</div>
<div class="section" id="merging-and-rebasing">
<h2>Merging and Rebasing<a class="headerlink" href="#merging-and-rebasing" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="reset-and-recovery">
<span id="section-git-recovery"></span><h2>Reset and Recovery<a class="headerlink" href="#reset-and-recovery" title="Permalink to this headline">¶</a></h2>
<p>Git makes it very hard to truly mess up. Here is a short way to get
back onto your feet, no matter what. First, if you just want to go
back to a working Sage installation you can always abandon your
working branch by switching to your local copy of the <tt class="docutils literal"><span class="pre">build_system</span></tt>
branch:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git checkout build_system</pre>
</div>
<p>As long as you did not make any changes to the <tt class="docutils literal"><span class="pre">build_system</span></tt> branch
directly, this will give you back a working Sage.</p>
<p>If you want to keep your branch but go back to a previous commit you
can use the <em>reset</em> command. For this, look up the commit in the log
which is some 40-digit hexadecimal number. Then use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">reset</span>
<span class="pre">--hard</span></tt> to revert your files back to the previous state:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git log
...
commit eafaedad5b0ae2013f8ae1091d2f1df58b72bae3
Author: First Last &lt;user@email.com&gt;
Date:   Sat Jul 20 21:57:33 2013 -0400

    Commit message
...
[user@localhost sage]$ git reset --hard eafae</pre>
</div>
<p>You only need to type the first couple of hex digits, git will
complain if this does not uniquely specify a commit. Also, there is
the useful abbreviation <tt class="docutils literal"><span class="pre">HEAD~</span></tt> for the previous commit and
<tt class="docutils literal"><span class="pre">HEAD~n</span></tt>, with some integer <tt class="docutils literal"><span class="pre">n</span></tt>, for the n-th previous commit.</p>
<p>Finally, perhaps the ultimate human error recovery tool is the
reflog. This is a chronological history of git operations that you can
undo if needed. For example, let us assume we messed up the <em>git
reset</em> command and went back too far (say, 5 commits back). And, on
top of that, deleted a file and committed that:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git reset --hard HEAD~5
[user@localhost sage]$ git rm sage
[user@localhost sage]$ git commit -m "I shot myself into my foot"</pre>
</div>
<p>Now we cannot just checkout the repository from before the reset,
because it is no longer in the history. However, here is the reflog:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git reflog
2eca2a2 HEAD@{0}: commit: I shot myself into my foot
b4d86b9 HEAD@{1}: reset: moving to HEAD~5
af353bb HEAD@{2}: checkout: moving from some_branch to master
1142feb HEAD@{3}: checkout: moving from other_branch to some_branch
...</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">HEAD&#64;{n}</span></tt> revisions are shortcuts for the history of git
operations. Since we want to rewind to before the erroneous <em>git
reset</em> command, we just have to reset back into the future:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git reset --hard HEAD@{2}</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Git the Hard Way</a><ul>
<li><a class="reference internal" href="#branching-out">Branching Out</a></li>
<li><a class="reference internal" href="#the-trac-server">The Trac Server</a></li>
<li><a class="reference internal" href="#checking-out-tickets">Checking Out Tickets</a></li>
<li><a class="reference internal" href="#pushing-your-changes-to-a-ticket">Pushing Your Changes to a Ticket</a></li>
<li><a class="reference internal" href="#merging-and-rebasing">Merging and Rebasing</a></li>
<li><a class="reference internal" href="#reset-and-recovery">Reset and Recovery</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="git_background.html"
                                  title="previous chapter">Git Background</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="sagenb/index.html"
                                  title="next chapter">Sage Notebook Developer Guide</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/manual_git.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sagenb/index.html" title="Sage Notebook Developer Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="git_background.html" title="Git Background"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2013, The Sage Development Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;  
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');
    
    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });
    
    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();
    
    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };
    
    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });
    
    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>