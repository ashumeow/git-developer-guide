
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Git the Hard Way &mdash; Sage Developer&#39;s Guide v1.0</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v1.0" href="index.html" />
    <link rel="next" title="Distributed Development" href="workflows.html" />
    <link rel="prev" title="Git Background" href="git_background.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="workflows.html" title="Distributed Development"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="git_background.html" title="Git Background"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="git-the-hard-way">
<span id="chapter-manual-git"></span><h1>Git the Hard Way<a class="headerlink" href="#git-the-hard-way" title="Permalink to this headline">¶</a></h1>
<p>For beginners to Sage development we recommend using the Sage
development scripts as explained in <a class="reference internal" href="walk_through.html#chapter-walk-through"><em>Sage Development Process</em></a>, which
simplify using git and the trac server. However, you can use git
directly to work on Sage if you want to take off the training
wheels. This chapter will tell you how to do so assuming some
basic familiarity with git.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For now, use the <tt class="docutils literal"><span class="pre">public/sage-git/master</span></tt> branch instead of
master. This will be changed soon.</p>
</div>
<p>We assume that you have a copy of the Sage git repository, for example
by running:</p>
<div class="highlight-python"><pre>[user@localhost ~]$ git clone git://github.com/sagemath/sage.git -b build_system
[user@localhost ~]$ cd sage
[user@localhost sage]$ make</pre>
</div>
<div class="section" id="branching-out">
<span id="section-git-branch"></span><h2>Branching Out<a class="headerlink" href="#branching-out" title="Permalink to this headline">¶</a></h2>
<p>A branch is any set of changes that deviates from the current official
Sage tree. Whenever you start developing some new feature or fix a bug
you should first create a new branch to hold the changes. It is easy
to create a new branch, just check out (switch to) the branch from
where you want to start (that is, <tt class="docutils literal"><span class="pre">build_system</span></tt>) and use the <em>git
branch</em> command:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git checkout build_system
[user@localhost sage]$ git branch my_new_branch
[user@localhost sage]$ git checkout my_new_branch
[user@localhost sage]$ git branch
  build_system
* my_new_branch</pre>
</div>
<p>Without an argument, the <em>git branch</em> command just displays a list of
all local branches with the current one marked by an asterisk. Also
note that <em>git branch</em> creates a new branch, but does not switch to
it. To avoid typing the new branch name twice you can use the shortcut
<tt class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">my_new_branch</span></tt> to create and switch to the new
branch in one command.</p>
</div>
<div class="section" id="commits-snapshots">
<span id="section-git-commit"></span><h2>Commits (Snapshots)<a class="headerlink" href="#commits-snapshots" title="Permalink to this headline">¶</a></h2>
<p>Once you have your own branch feel free to make any changes as you
like. Whenever you have reached your goal, a milestone towards it, or
just feel like you got some work done you should commit your
changes. That is, snapshot the state of all files in the
repository. First, you need to <em>stage</em> the changed files, which tells
git which files you want to be part of the next commit:</p>
<div class="highlight-python"><pre>... edit foobar.txt ...

[user@localhost sage]$ git status
# On branch build_system
# Untracked files:
#   (use "git add &lt;file&gt;..." to include in what will be committed)
#
#       foobar.txt
nothing added to commit but untracked files present (use "git add" to track)

[user@localhost sage]$ git add foobar.txt
[user@localhost sage]$ git status
# On branch build_system
# Changes to be committed:
#   (use "git reset HEAD &lt;file&gt;..." to unstage)
#
#   new file:   foobar.txt
#</pre>
</div>
<p>Once you are satisfied with the list of staged files, you create a new
snapshot with the <em>commit</em> command:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git commit
... editor opens ...
[build_system 31331f7] Added the very important foobar text file
 1 file changed, 1 insertion(+)
  create mode 100644 foobar.txt</pre>
</div>
<p>This will open an editor for you to write your commit message. The
commit message should generally have a one-line description, followed
by an empty line, followed by further explanatory text:</p>
<div class="highlight-python"><pre>Added the very important foobar text file

This is an example commit message. You see there is a one-line
summary followed by more detailed description, if necessary.</pre>
</div>
<p>You can then continue working towards your next milestone, make
another commit, repeat until finished. As long as you do not
<em>checkout</em> another branch, all commits that you make will be part of
the branch that you created.</p>
</div>
<div class="section" id="the-trac-server">
<span id="section-git-trac"></span><h2>The Trac Server<a class="headerlink" href="#the-trac-server" title="Permalink to this headline">¶</a></h2>
<p>The Sage trac server also holds a copy of the Sage repository, it is
served via ssh but at the non-standard port 2222. To add it as a
remote repository to your local git repository, use the command:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git remote add trac ssh://git@trac.sagemath.org:2222/sage.git -t master
[user@localhost sage]$ git remote -v
origin      git://github.com/sagemath/sage.git (fetch)
origin      git://github.com/sagemath/sage.git (push)
trac        ssh://git@trac.sagemath.org:2222/sage.git (fetch)
trac        ssh://git@trac.sagemath.org:2222/sage.git (push)</pre>
</div>
<p>Instead of <tt class="docutils literal"><span class="pre">trac</span></tt> you can use any local name you want, of course. It
is perfectly fine to have multiple remote repositories for git, think
of them as bookmarks. You can then use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt> to get changes and
<tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt> to upload your local changes using:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git &lt;push|pull&gt; trac [ARGS]</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the command above we set up the remote to only track the
<tt class="docutils literal"><span class="pre">master</span></tt> branch on the trac server (the <tt class="docutils literal"><span class="pre">-t</span> <span class="pre">master</span></tt>
option). This avoids clutter by not automatically downloading all
branches ever created. But it also means that you will not fetch
everything that is on trac by default, and you need to explicitly
tell git which branch you want to get from trac. See the
<a class="reference internal" href="#section-git-checkout"><em>Checking Out Tickets</em></a> section for examples.</p>
</div>
<p>The way we set up the remote here is via ssh authentication (the
<tt class="docutils literal"><span class="pre">ssh://</span></tt> part), this requires you to have a trac account and to set
up your ssh public key as described in
<a class="reference internal" href="trac.html#section-trac-ssh-key"><em>Linking your Public Key to your Trac Account</em></a>. Authentication is necessary if you want
to upload anything to ensure that it really is from you and not from
an impostor. However, if you just want to download branches from the
trac server then you can set up the remote to use the git protocol
without authentication:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git remote add trac git://trac.sagemath.org/sage.git -t master</pre>
</div>
<p>Setting up the remote repository this way allows you to do perform all
steps covered this manual (except for <a class="reference internal" href="#section-git-push"><em>Pushing Your Changes to a Ticket</em></a>) without
having a trac account. To switch between the two setups, just remove
the current remote repository with <tt class="docutils literal"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">remove</span> <span class="pre">trac</span></tt> and then
run the respective <tt class="docutils literal"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">add</span> <span class="pre">trac</span> <span class="pre">...</span></tt> command.</p>
<div class="section" id="checking-out-tickets">
<span id="section-git-checkout"></span><h3>Checking Out Tickets<a class="headerlink" href="#checking-out-tickets" title="Permalink to this headline">¶</a></h3>
<p>Trac tickets that are finished or in the process of being worked on
can have a git branch attached to them. This is the &#8220;Branch:&#8221; field in
the ticket description. The branch name is generally of the form
<tt class="docutils literal"><span class="pre">u/user/description</span></tt>, where <tt class="docutils literal"><span class="pre">user</span></tt> is the name of the user who
made the branch and <tt class="docutils literal"><span class="pre">description</span></tt> is some free-form short
description (and can include further slashes).</p>
<p>If you want to work with the changes in that remote branch, you must
make a local copy. In particular, git has no concept of directly
working with the remote branch, the remotes are only bookmarks for
things that you can get from/to the remote server. Hence, the first
thing you should do is to get everything from the trac server&#8217;s branch
into your local repository. This is achieved by:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git fetch trac u/user/description
remote: Counting objects: 62, done.
remote: Compressing objects: 100% (48/48), done.
remote: Total 48 (delta 42), reused 0 (delta 0)
Unpacking objects: 100% (48/48), done.
From ssh://trac.sagemath.org:2222/sage
* [new branch]      u/user/description -&gt; FETCH_HEAD</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">u/user/description</span></tt> branch is now temporarily (until you fetch
something else) stored in your local git database under the alias
<tt class="docutils literal"><span class="pre">FETCH_HEAD</span></tt>. In the second step, we make it available as a new
local branch and switch to it. Your local branch can have a different
name, for example:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git checkout -b my_branch FETCH_HEAD
Switched to a new branch 'my_branch'</pre>
</div>
<p>creates a new branch in your local git repository named <tt class="docutils literal"><span class="pre">my_branch</span></tt>
and modifies your local Sage filesystem tree to the state of the files
in that ticket. You can now edit files and commit changes to your
local branch.</p>
</div>
<div class="section" id="pushing-your-changes-to-a-ticket">
<span id="section-git-push"></span><h3>Pushing Your Changes to a Ticket<a class="headerlink" href="#pushing-your-changes-to-a-ticket" title="Permalink to this headline">¶</a></h3>
<p>To add your local branch to a trac ticket, you should first decide on
a name on the Sage trac repository. In order to avoid name clashes,
you have push permissions to branches of the form <tt class="docutils literal"><span class="pre">u/user/*</span></tt> where
<tt class="docutils literal"><span class="pre">user</span></tt> is your trac username and <tt class="docutils literal"><span class="pre">*</span></tt> is a wildcard, that is, any
valid git branch name. By default, you do <em>not</em> have push permissions
to other user&#8217;s branches or the Sage master branch. In the following,
we will be using <tt class="docutils literal"><span class="pre">u/user/description</span></tt> as the branch name, where it
is understood that you replaced</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">user</span></tt> with your trac username, and</li>
<li><tt class="docutils literal"><span class="pre">description</span></tt> with some (short but self-explanatory) description of
your branch. May contain further slashes, but spaces are not allowed.</li>
</ul>
<p>Your first step should be to put your chosen name into the &#8220;Branch:&#8221;
field on the trac ticket. To push your branch to trac you now use
either:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git push --set-upstream trac my_branch:u/user/description</pre>
</div>
<p>if you started the branch yourself and do not follow any other branch,
or use:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git push my_branch:u/user/description</pre>
</div>
<p>if your branch already has an upstream branch. The remaining arguments
are</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">my_branch</span></tt> is the name of your local branch,</li>
<li><tt class="docutils literal"><span class="pre">user</span></tt> is your trac username,</li>
<li><tt class="docutils literal"><span class="pre">description</span></tt> the description of your branch.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">Branch</span></tt> field is color coded: red means there is an issue,
green means it will merge cleanly into <tt class="docutils literal"><span class="pre">master</span></tt>. If it is red, the
tooltip will tell you what is wrong.  If it is green, then it will
link to a diff of the changes against <tt class="docutils literal"><span class="pre">u/ohanar/build_system</span></tt>. (This
is temporary until <a class="reference external" href="http://trac.sagemath.org/14480">#14480</a> is merged
into the <tt class="docutils literal"><span class="pre">master</span></tt> branch.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You also have to fill in the &#8220;Commit:&#8221; field with the 40-digit
SHA1 hash of your last commit. If you first fill out the &#8220;Branch:&#8221;
field on trac and then push to git, then git will automatically
search for the ticket and fill in the &#8220;Commit:&#8221; field for you.</p>
<p>If, for some reason, you first push to the trac git repository and
then change the &#8220;Branch:&#8221; field, then you also have to update the
&#8220;Commit:&#8221; field yourself. You can find out the SHA1 hash, for
example, with:</p>
<div class="last highlight-python"><pre>$ git log -1
commit 2ee18c5b5c7417e0f8939d9db54d753c468964d8
Author: Firstname Lastname &lt;user@sagemath.org&gt;
Date:   Wed Aug 7 21:50:00 2013 +0100

    My first commit message!</pre>
</div>
</div>
<p>The above git commands create a new remote branch. If you make any
further local edits, then you need a slight variation of the command
to push your changes (but not create a new remote branch). So assume
that you made some further changes to your local branch and committed
them. Then you just have to push a certain commit, either specified by
its hex number or by the abbreviation <tt class="docutils literal"><span class="pre">HEAD</span></tt> for the most recent
one:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git push trac HEAD:u/user/description</pre>
</div>
</div>
<div class="section" id="getting-changes">
<span id="section-git-pull"></span><h3>Getting Changes<a class="headerlink" href="#getting-changes" title="Permalink to this headline">¶</a></h3>
<p>A common task during development is to synchronize your local copy of
the branch with the branch on trac. In particular, assume you
downloaded somebody else&#8217;s branch made some suggestions for
improvements on the trac ticket. Now the original author incorporated
your suggestions into his branch, and you want to get the added
changesets to complete your review. Assuming that you originally got
your local branch as in <a class="reference internal" href="#section-git-checkout"><em>Checking Out Tickets</em></a>, you can just
issue:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git pull -r trac u/user/description
From ssh://trac.sagemath.org:2222/sage
 * branch            u/user/description -&gt; FETCH_HEAD
First, rewinding head to replay your work on top of it...
Fast-forwarded my_branch to 19e832a93094abbf7486b51335e6b0f7dc91478c.</pre>
</div>
<p>This will download the changes from the originally-used remote branch
and rebase (the <tt class="docutils literal"><span class="pre">-r</span></tt> command line option) your local branch onto
them. Rebasing is appropriate if you haven&#8217;t published any changes to
the ticket yourself, see the <a class="reference internal" href="#section-git-merge"><em>Merging and Rebasing</em></a> section if that
is not the case.</p>
</div>
</div>
<div class="section" id="merging-and-rebasing">
<span id="section-git-merge"></span><h2>Merging and Rebasing<a class="headerlink" href="#merging-and-rebasing" title="Permalink to this headline">¶</a></h2>
<p>Invariably, Sage development continues while you are working on your
local branch. For example, let us assume you started <tt class="docutils literal"><span class="pre">my_branch</span></tt> at
commit <tt class="docutils literal"><span class="pre">B</span></tt>. After a while, your branch has advanced to commit <tt class="docutils literal"><span class="pre">Z</span></tt>
while the Sage master branch has advanced to <tt class="docutils literal"><span class="pre">D</span></tt></p>
<div class="highlight-python"><pre>      X---Y---Z my_branch
     /
A---B---C---D master</pre>
</div>
<p>How should you deal with upstream changes while you are
still developing your code? In principle, there are two ways of
dealing with it:</p>
<ul>
<li><p class="first">The first solution is to change the commits in your local branch to
start out at the new master. This is called <strong>rebase</strong>:</p>
<div class="highlight-python"><pre>git checkout my_branch
git rebase master</pre>
</div>
<p>In terms of the commit graph, this results in:</p>
<div class="highlight-python"><pre>              X'--Y'--Z' my_branch
             /
A---B---C---D master</pre>
</div>
<p>Since the SHA1 hash includes the hash of the parent, all commits
change. This means that you should only ever use rebase if nobody
else has used one of your <tt class="docutils literal"><span class="pre">X</span></tt>, <tt class="docutils literal"><span class="pre">Y</span></tt>, <tt class="docutils literal"><span class="pre">Z</span></tt> commits to base their
development on.</p>
</li>
<li><p class="first">The other solution is to not change any commits, and instead create
a new merge commit <tt class="docutils literal"><span class="pre">W</span></tt> which merges in the changes from the newer
master. This is called <strong>merge</strong>:</p>
<div class="highlight-python"><pre>git checkout my_branch
git merge master</pre>
</div>
<p>The result is the following commit graph:</p>
<div class="highlight-python"><pre>      X---Y---Z---W my_branch
     /           /
A---B---C-------D master</pre>
</div>
<p>The downside is that it introduced an extra merge commit that would
not be there had you used rebase. But that is also the advantage of
merging: None of the existing commits is changed, only a new commit
is made. This additional commit is then easily pushed to the git
repository and distributed to your collaborators.</p>
</li>
</ul>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">more on merge vs rebase</p>
</div>
</div>
<div class="section" id="detached-heads-and-reviewing-tickets">
<span id="section-git-detached-head"></span><h2>Detached Heads and Reviewing Tickets<a class="headerlink" href="#detached-heads-and-reviewing-tickets" title="Permalink to this headline">¶</a></h2>
<p>Each commit is a snapshot of the Sage source tree at a certain
point. So far, we always used commits organized in branches. But
secretly the branch is just a shortcut for a particular commit, the
head commit of the branch. But you can just go to a particular commit
without a branch, this is called &#8220;detached head&#8221;. If you have the
commit already in your local history, you can directly check it
out without requiring internet access:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git checkout a63227d0636e29a8212c32eb9ca84e9588bbf80b
Note: checking out 'a63227d0636e29a8212c32eb9ca84e9588bbf80b'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b new_branch_name

HEAD is now at a63227d... Szekeres Snark Graph constructor</pre>
</div>
<p>If it is not stored in your local git repository, you need to download
it from the trac server first:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git fetch trac a63227d0636e29a8212c32eb9ca84e9588bbf80b
From ssh://trac/sage
 * branch            a63227d0636e29a8212c32eb9ca84e9588bbf80b -&gt; FETCH_HEAD
[user@localhost sage]$ git checkout FETCH_HEAD
HEAD is now at a63227d... Szekeres Snark Graph constructor</pre>
</div>
<p>Either way, you end up with your current HEAD and working directory
that is not associated to any local branch:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git status
# HEAD detached at a63227d
nothing to commit, working directory clean</pre>
</div>
<p>This is perfectly fine. You can switch to an existing branch (with the
usual <tt class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">my_branch</span></tt>) and back to your detached head.</p>
<p>Detached heads can be used to your advantage when reviewing
tickets. Just check out the commit (look at the &#8220;Commit:&#8221; field on the
trac ticket) that you are reviewing as a detached head. Then you can
look at the changes and run tests in the detached head. When you are
finished with the review, you just abandon the detached head. That way
you never create a new local branch, so you don&#8217;t have to type <tt class="docutils literal"><span class="pre">git</span>
<span class="pre">branch</span> <span class="pre">-D</span> <span class="pre">my_branch</span></tt> at the end to delete the local branch that you
created only to review the ticket.</p>
</div>
<div class="section" id="reset-and-recovery">
<span id="section-git-recovery"></span><h2>Reset and Recovery<a class="headerlink" href="#reset-and-recovery" title="Permalink to this headline">¶</a></h2>
<p>Git makes it very hard to truly mess up. Here is a short way to get
back onto your feet, no matter what. First, if you just want to go
back to a working Sage installation you can always abandon your
working branch by switching to your local copy of the <tt class="docutils literal"><span class="pre">build_system</span></tt>
branch:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git checkout build_system</pre>
</div>
<p>As long as you did not make any changes to the <tt class="docutils literal"><span class="pre">build_system</span></tt> branch
directly, this will give you back a working Sage.</p>
<p>If you want to keep your branch but go back to a previous commit you
can use the <em>reset</em> command. For this, look up the commit in the log
which is some 40-digit hexadecimal number (the SHA1 hash). Then use
<tt class="docutils literal"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span></tt> to revert your files back to the previous state:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git log
...
commit eafaedad5b0ae2013f8ae1091d2f1df58b72bae3
Author: First Last &lt;user@email.com&gt;
Date:   Sat Jul 20 21:57:33 2013 -0400

    Commit message
...
[user@localhost sage]$ git reset --hard eafae</pre>
</div>
<p>You only need to type the first couple of hex digits, git will
complain if this does not uniquely specify a commit. Also, there is
the useful abbreviation <tt class="docutils literal"><span class="pre">HEAD~</span></tt> for the previous commit and
<tt class="docutils literal"><span class="pre">HEAD~n</span></tt>, with some integer <tt class="docutils literal"><span class="pre">n</span></tt>, for the n-th previous commit.</p>
<p>Finally, perhaps the ultimate human error recovery tool is the
reflog. This is a chronological history of git operations that you can
undo if needed. For example, let us assume we messed up the <em>git
reset</em> command and went back too far (say, 5 commits back). And, on
top of that, deleted a file and committed that:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git reset --hard HEAD~5
[user@localhost sage]$ git rm sage
[user@localhost sage]$ git commit -m "I shot myself into my foot"</pre>
</div>
<p>Now we cannot just checkout the repository from before the reset,
because it is no longer in the history. However, here is the reflog:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git reflog
2eca2a2 HEAD@{0}: commit: I shot myself into my foot
b4d86b9 HEAD@{1}: reset: moving to HEAD~5
af353bb HEAD@{2}: checkout: moving from some_branch to master
1142feb HEAD@{3}: checkout: moving from other_branch to some_branch
...</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">HEAD&#64;{n}</span></tt> revisions are shortcuts for the history of git
operations. Since we want to rewind to before the erroneous <em>git
reset</em> command, we just have to reset back into the future:</p>
<div class="highlight-python"><pre>[user@localhost sage]$ git reset --hard HEAD@{2}</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Git the Hard Way</a><ul>
<li><a class="reference internal" href="#branching-out">Branching Out</a></li>
<li><a class="reference internal" href="#commits-snapshots">Commits (Snapshots)</a></li>
<li><a class="reference internal" href="#the-trac-server">The Trac Server</a><ul>
<li><a class="reference internal" href="#checking-out-tickets">Checking Out Tickets</a></li>
<li><a class="reference internal" href="#pushing-your-changes-to-a-ticket">Pushing Your Changes to a Ticket</a></li>
<li><a class="reference internal" href="#getting-changes">Getting Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#merging-and-rebasing">Merging and Rebasing</a></li>
<li><a class="reference internal" href="#detached-heads-and-reviewing-tickets">Detached Heads and Reviewing Tickets</a></li>
<li><a class="reference internal" href="#reset-and-recovery">Reset and Recovery</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="git_background.html"
                                  title="previous chapter">Git Background</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="workflows.html"
                                  title="next chapter">Distributed Development</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/manual_git.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="workflows.html" title="Distributed Development"
             >next</a> |</li>
        <li class="right" >
          <a href="git_background.html" title="Git Background"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2013, The Sage Development Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;  
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');
    
    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });
    
    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();
    
    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };
    
    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });
    
    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>