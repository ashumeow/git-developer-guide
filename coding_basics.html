
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>General Conventions &mdash; Sage Developer&#39;s Guide v1.0</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v1.0" href="index.html" />
    <link rel="next" title="Coding in Python for Sage" href="coding_in_python.html" />
    <link rel="prev" title="The Sage Trac Server" href="trac.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="coding_in_python.html" title="Coding in Python for Sage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="trac.html" title="The Sage Trac Server"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="general-conventions">
<span id="chapter-code-basics"></span><h1>General Conventions<a class="headerlink" href="#general-conventions" title="Permalink to this headline">¶</a></h1>
<p>If there is something you would like to implement and make available
in Sage, you have a wide range of options:</p>
<ol class="arabic simple">
<li>Implement it as Sage scripts, see <a class="reference internal" href="coding_in_python.html#section-preparsing"><em>Sage Preparsing</em></a>.</li>
<li>Implement it as Python scripts that use the Sage library, see
<a class="reference internal" href="coding_in_python.html#chapter-python"><em>Coding in Python for Sage</em></a>.</li>
<li>Implement it in C/C++ and make the result accessible to Sage using
Cython.</li>
<li>Implement it using Cython.</li>
<li>Implement it using one or more of the following: Flint, FpLLL, GAP,
GSL, IML, LinBox, M4RI, Matplotlib, Maxima, MWRank, ECLib,
NetworkX, NTL, Numpy, PARI/GP, PolyBoRi, R, Scipy, Singular, Sympy
or any of the other libraries included with Sage <a class="footnote-reference" href="#id2" id="id1">[1]</a>.</li>
<li>Or any combination of the above.</li>
<li>If you have Magma, Maple or Mathematica and do not mind restricting
who can use your code, you could also implement parts of your
program in one of these systems and make it available in Sage
through interfaces to these non-free systems.</li>
</ol>
<p>Flint, FpLLL, GAP, GSL, IML, LinBox, M4RI, Matplotlib, Maxima, MWRank,
ECLib, NetworkX, NTL, Numpy, PARI/GP, PolyBoRi, R, Scipy, Singular,
Sympy are all included with all distributions of Sage. GAP, Singular,
and PARI are very mature, and each implements a great amount of
functionality, though in different domains. GAP addresses group theory
well, Singular attacks polynomial computation, and PARI contains
sophisticated, optimized number theory algorithms.</p>
<p>Sage is not just about gathering together functionality. It is about
providing a clear, systematic and consistent way to access a large
number of algorithms, in a coherent framework that makes sense
mathematically. In the design of Sage, the semantics of objects, the
definitions, etc., are informed by how the corresponding objects are
used in everyday mathematics.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>See <a class="reference external" href="http://www.sagemath.org/links-components.html">http://www.sagemath.org/links-components.html</a> for a full list
of packages shipped with every copy of Sage</td></tr>
</tbody>
</table>
<p>To meet the goal of making Sage easy to read, maintain, and improve,
all Python/Cython code that is included with Sage should adhere to the
style conventions discussed in this chapter.</p>
<div class="section" id="python-code-style">
<span id="section-coding-python"></span><h2>Python Code Style<a class="headerlink" href="#python-code-style" title="Permalink to this headline">¶</a></h2>
<p>Follow the standard Python formatting rules when writing code for
Sage, as explained at the following URLs:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.python.org/dev/peps/pep-0008">http://www.python.org/dev/peps/pep-0008</a></li>
<li><a class="reference external" href="http://www.python.org/dev/peps/pep-0257">http://www.python.org/dev/peps/pep-0257</a></li>
</ul>
<p>In particular,</p>
<ul>
<li><p class="first">Use 4 spaces for indentation levels. Do not use tabs as they can
result in indentation confusion. Most editors have a feature that
will insert 4 spaces when the tab key is hit. Also, many editors
will automatically search/replace leading tabs with 4 spaces.</p>
</li>
<li><p class="first">Whitespace before and after assignment and binary operator of the
lowest priority in the expression:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">No whitespace before or after the <tt class="docutils literal"><span class="pre">=</span></tt> sign if it is used for
keyword arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">complex</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">magic</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">real</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">No whitespace immediately inside parenthesis, brackets, and braces:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spam</span><span class="p">(</span><span class="n">ham</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="n">eggs</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="p">[</span><span class="n">i</span><span class="o">^</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p class="first">Use all lowercase function names with words separated by
underscores. For example, you are encouraged to write Python
functions using the naming convention:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">set_some_value</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Note, however, that some functions do have uppercase letters where
it makes sense. For instance, the function for lattice reduction by
the LLL algorithm is called <tt class="docutils literal"><span class="pre">Matrix_integer_dense.LLL</span></tt>.</p>
</li>
<li><p class="first">Use CamelCase for class names:</p>
<div class="highlight-python"><pre>class SomeValue(object):
    def __init__(self, x):
    self._x  = 1</pre>
</div>
<p>and factory functions that mimic object constructors, for example
<tt class="docutils literal"><span class="pre">PolynomialRing</span></tt> or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">SomeIdentityValue</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SomeValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="files-and-directory-structure">
<span id="chapter-directory-structure"></span><h2>Files and Directory Structure<a class="headerlink" href="#files-and-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>Roughly, the Sage directory tree is layout like this. Note that we use
<tt class="docutils literal"><span class="pre">SAGE_ROOT</span></tt> in the following as a shortcut for the (arbitrary) name
of the directory containing the Sage sources:</p>
<div class="highlight-python"><pre>SAGE_ROOT/
    sage          # the Sage launcher
    Makefile      # top level Makefile
    build/        # sage's build system
        deps
        install
        ...
        pkgs/     # install, patch, and metadata from spkgs
    src/
        setup.py
        module_list.py
        ...
        sage/     # sage library, i.e. devel/sage-main/sage
        ext/      # sage_extcode, i.e. devel/ext-main
        mac-app/  # would no longer have to awkwardly be in extcode
        bin/      # the scripts in local/bin that are tracked
    upstream/     # tarballs of upstream sources
    local/        # installed binaries</pre>
</div>
<p>Python Sage library code goes into <tt class="docutils literal"><span class="pre">src/</span></tt> and uses the following
conventions. Directory names may be plural (e.g. <tt class="docutils literal"><span class="pre">rings</span></tt>) and file
names are almost always singular (e.g. <tt class="docutils literal"><span class="pre">polynomial_ring.py</span></tt>). Note
that the file <tt class="docutils literal"><span class="pre">polynomial_ring.py</span></tt> might still contain definitions
of several different types of polynomial rings.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You are encouraged to include miscellaneous notes, emails, design
discussions, etc., in your package.  Make these plain text files
(with extension <tt class="docutils literal"><span class="pre">.txt</span></tt>) in a subdirectory called <tt class="docutils literal"><span class="pre">notes</span></tt>.  For
example, see <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/ext/notes/</span></tt>.</p>
</div>
<p>If you want to create a new directory in the Sage library
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage</span></tt> (say, <tt class="docutils literal"><span class="pre">measure_theory</span></tt>), that directory
should contain an empty file <tt class="docutils literal"><span class="pre">__init__.py</span></tt> in addition to whatever
files you want to add (say, <tt class="docutils literal"><span class="pre">borel_measure.py</span></tt> and
<tt class="docutils literal"><span class="pre">banach_tarski.py</span></tt>), and also a file <tt class="docutils literal"><span class="pre">all.py</span></tt> listing imports from
that directory.  The file <tt class="docutils literal"><span class="pre">all.py</span></tt> might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">borel_measure</span> <span class="kn">import</span> <span class="n">BorelMeasure</span>
<span class="kn">from</span> <span class="nn">banach_tarski</span> <span class="kn">import</span> <span class="n">BanachTarskiParadox</span>
</pre></div>
</div>
<p>but it is generally better to use the lazy import framework:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sage.misc.lazy_import</span> <span class="kn">import</span> <span class="n">lazy_import</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="s">&#39;sage.measure_theory.borel_measue&#39;</span><span class="p">,</span> <span class="s">&#39;BorelMeasure&#39;</span><span class="p">)</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="s">&#39;sage.measure_theory.banach_tarski&#39;</span><span class="p">,</span> <span class="s">&#39;BanachTarskiParadox&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then in the file <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/all.py</span></tt>, add a line</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sage.measure_theory.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="an-example-is-worth-a-thousand-words">
<h2>An example is worth a thousand words<a class="headerlink" href="#an-example-is-worth-a-thousand-words" title="Permalink to this headline">¶</a></h2>
<p>For all of the conventions discussed here, you can find many examples
in the Sage library.  Browsing through the code is helpful, but so is
searching: the functions <tt class="docutils literal"><span class="pre">search_src</span></tt>, <tt class="docutils literal"><span class="pre">search_def</span></tt>, and
<tt class="docutils literal"><span class="pre">search_doc</span></tt> are worth knowing about.  Briefly, from the &#8220;sage:&#8221;
prompt, <tt class="docutils literal"><span class="pre">search_src(string)</span></tt> searches Sage library code for the
string <tt class="docutils literal"><span class="pre">string</span></tt>. The command <tt class="docutils literal"><span class="pre">search_def(string)</span></tt> does a similar
search, but restricted to function definitions, while
<tt class="docutils literal"><span class="pre">search_doc(string)</span></tt> searches the Sage documentation.  See their
docstrings for more information and more options.</p>
</div>
<div class="section" id="headings-of-sage-library-code-files">
<h2>Headings of Sage library code files<a class="headerlink" href="#headings-of-sage-library-code-files" title="Permalink to this headline">¶</a></h2>
<p>The top of each Sage code file should follow this format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">&lt;Very short 1-line summary&gt;</span>

<span class="sd">&lt;Paragraph description&gt;</span>

<span class="sd">AUTHORS:</span>

<span class="sd">- YOUR NAME (2005-01-03): initial version</span>

<span class="sd">- person (date in ISO year-month-day format): short desc</span>

<span class="sd">EXAMPLES::</span>

<span class="sd">&lt;Lots and lots of examples&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#*****************************************************************************</span>
<span class="c">#       Copyright (C) 2013 YOUR NAME &lt;your email&gt;</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#                  http://www.gnu.org/licenses/</span>
<span class="c">#*****************************************************************************</span>
</pre></div>
</div>
<p>As an example, see <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/rings/integer.pyx</span></tt> which
contains the implementation for <span class="math">\(\ZZ\)</span>. The <tt class="docutils literal"><span class="pre">AUTHORS:</span></tt> section is
redundant, the authorative log for who wrote what is always the git
repository (see the output of <tt class="docutils literal"><span class="pre">git</span> <span class="pre">blame</span></tt>). Nevertheless, it is
sometimes useful to have a very rough overview over the history,
especially if a lot of people have been working on that source file.</p>
<p>All code included with Sage must be licensed under the GPLv3+ or a
compatible, that is, less restrictive license (e.g. GPLv2+ or the BSD
license).</p>
</div>
<div class="section" id="documentation-strings">
<span id="section-docstrings"></span><h2>Documentation strings<a class="headerlink" href="#documentation-strings" title="Permalink to this headline">¶</a></h2>
<div class="section" id="docstring-markup-with-rest-and-sphinx">
<h3>Docstring markup with ReST and Sphinx<a class="headerlink" href="#docstring-markup-with-rest-and-sphinx" title="Permalink to this headline">¶</a></h3>
<p><strong>Every</strong> function must have a docstring that includes the following
information. Source files in the Sage library contain numerous
examples on how to format your documentation, so you could use them as
a guide.</p>
<ul>
<li><p class="first">A one-sentence description of the function, followed by a blank line
and ending in a period. It prescribes the function or method&#8217;s
effect as a command (&#8220;Do this&#8221;, &#8220;Return that&#8221;), not as a
description; e.g. don&#8217;t write &#8220;Returns the pathname ...&#8221;.</p>
</li>
<li><p class="first">An INPUT and an OUTPUT block for input and output arguments (see
below for format). The type names should be descriptive, but do not
have to represent the exact Sage/Python types. For example, use
&#8220;integer&#8221; for anything that behaves like an integer; you do not have
to put a precise type name such as <tt class="docutils literal"><span class="pre">int</span></tt>. The INPUT block
describes the expected input to your function or method, while the
OUTPUT block describes the expected output of the
function/method. If appropriate, you need to describe any default
values for the input arguments. For example:</p>
<div class="highlight-python"><pre>INPUT:

- ``p`` -- (default: 2) a positive prime integer.

OUTPUT:

A 5-tuple consisting of integers in this order:

1. the smallest primitive root modulo p
2. the smallest prime primitive root modulo p
3. the largest primitive root modulo p
4. the largest prime primitive root modulo p
5. total number of prime primitive roots modulo p</pre>
</div>
<p>Some people prefer to format their OUTPUT section as a block by
using a dash. That is acceptable as well:</p>
<div class="highlight-python"><pre>OUTPUT:

- The plaintext resulting from decrypting the ciphertext ``C``
  using the Blum-Goldwasser decryption algorithm.</pre>
</div>
</li>
<li><p class="first">An EXAMPLES block for examples. This is not optional. These
examples are used for automatic testing before each release and new
functions without these doctests will not be accepted for inclusion
with Sage.</p>
</li>
<li><p class="first">A SEEALSO block (optional) with links to related things in Sage. A SEEALSO
block should start with <tt class="docutils literal"><span class="pre">..</span> <span class="pre">SEEALSO::</span></tt>. It can also be the lower-case form
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">seealso::</span></tt>. However, you are encouraged to use the upper-case form
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">SEEALSO::</span></tt>. See <a class="reference internal" href="sage_manuals.html#chapter-sage-manuals-links"><em>Hyperlinks</em></a> for details on how
to setup link in Sage.  Here&#8217;s an example of a SEEALSO block:</p>
<div class="highlight-python"><pre>.. SEEALSO::

    :ref:`chapter-sage_manuals_links`</pre>
</div>
</li>
<li><p class="first">An ALGORITHM block (optional) which indicates what software
and/or what algorithm is used. For example
<tt class="docutils literal"><span class="pre">ALGORITHM:</span> <span class="pre">Uses</span> <span class="pre">Pari</span></tt>. Here&#8217;s a longer example that describes an
algorithm used. Note that it also cites the reference where this
algorithm can be found:</p>
<div class="highlight-python"><pre>ALGORITHM:

The following algorithm is adapted from page 89 of [Nat2000]_.

Let `p` be an odd (positive) prime and let `g` be a generator
modulo `p`. Then `g^k` is a generator modulo `p` if and only if
`\gcd(k, p-1) = 1`. Since `p` is an odd prime and positive, then
`p - 1` is even so that any even integer between 1 and `p - 1`,
inclusive, is not relatively prime to `p - 1`. We have now
narrowed our search to all odd integers `k` between 1 and `p - 1`,
inclusive.

So now start with a generator `g` modulo an odd (positive) prime
`p`. For any odd integer `k` between 1 and `p - 1`, inclusive,
`g^k` is a generator modulo `p` if and only if `\gcd(k, p-1) = 1`.

REFERENCES:

.. [Nat2000] M.B. Nathanson. Elementary Methods in Number Theory.
   Springer, 2000.</pre>
</div>
<p>You can also number the steps in your algorithm using the hash-dot
symbol. This way, the actual numbering of the steps are
automatically taken care of when you build the documentation:</p>
<div class="highlight-python"><pre>ALGORITHM:

The Blum-Goldwasser decryption algorithm is described in Algorithm
8.56, page 309 of [MenezesEtAl1996]_. The algorithm works as follows:

#. Let `C` be the ciphertext `C = (c_1, c_2, \dots, c_t, x_{t+1})`.
   Then `t` is the number of ciphertext sub-blocks and `h` is the
   length of each binary string sub-block `c_i`.
#. Let `(p, q, a, b)` be the private key whose corresponding
   public key is `n = pq`. Note that `\gcd(p, q) = ap + bq = 1`.
#. Compute `d_1 = ((p + 1) / 4)^{t+1} \bmod{(p - 1)}`.
#. Compute `d_2 = ((q + 1) / 4)^{t+1} \bmod{(q - 1)}`.
#. Let `u = x_{t+1}^{d_1} \bmod p`.
#. Let `v = x_{t+1}^{d_2} \bmod q`.
#. Compute `x_0 = vap + ubq \bmod n`.
#. For `i` from 1 to `t`, do:

   #. Compute `x_i = x_{t-1}^2 \bmod n`.
   #. Let `p_i` be the `h` least significant bits of `x_i`.
   #. Compute `m_i = p_i \oplus c_i`.

#. The plaintext is `m = m_1 m_2 \cdots m_t`.</pre>
</div>
</li>
<li><p class="first">A NOTE block for special notes (optional). Include information
such as purpose etc. A NOTE block should start with
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">NOTE::</span></tt>. You can also use the lower-case version
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">note::</span></tt>, but do not mix lower-case with upper-case. However,
you are encouraged to use the upper-case version <tt class="docutils literal"><span class="pre">..</span> <span class="pre">NOTE::</span></tt>. If
you want to put anything within the NOTES block, you should
indent it at least 4 spaces (no tabs). Here&#8217;s an example of a NOTE
block:</p>
<div class="highlight-python"><pre>.. NOTE::

    You should note that this sentence is indented at least 4
    spaces. Avoid tab characters as much as possible when
    writing code or editing the Sage documentation. You should
    follow Python conventions by using spaces only.</pre>
</div>
</li>
<li><p class="first">A WARNING block for critical information about your code. For
example, the WARNING block might include information about when or
under which conditions your code might break, or information that
the user should be particularly aware of. A WARNING block should start
with <tt class="docutils literal"><span class="pre">..</span> <span class="pre">WARNING::</span></tt>. It can also be the lower-case form
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">warning::</span></tt>. However, you are encouraged to use the upper-case
form <tt class="docutils literal"><span class="pre">..</span> <span class="pre">WARNING::</span></tt>. Here&#8217;s an example of a WARNING block:</p>
<div class="highlight-python"><pre>.. WARNING::

    Whenever you edit the Sage documentation, make sure that
    the edited version still builds. That is, you need to ensure
    that you can still build the HTML and PDF versions of the
    updated documentation. If the edited documentation fails to
    build, it is very likely that you would be requested to
    change your patch.</pre>
</div>
</li>
<li><p class="first">A TODO block for room for improvements. The TODO block might
contains disabled doctests to demonstrate the desired feature.  A TODO block
should start with <tt class="docutils literal"><span class="pre">..</span> <span class="pre">TODO::</span></tt>. It can also be the lower-case form
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">todo::</span></tt>. However, you are encouraged to use the upper-case form
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">TODO::</span></tt>. Here&#8217;s an example of a TODO block:</p>
<div class="highlight-python"><pre>.. TODO::

    Improve further function ``have_fresh_beers`` using algorithm
    ``buy_a_better_fridge``::

        sage: have_fresh_beers('Bière de l\'Yvette') # todo: not implemented
        Enjoy !</pre>
</div>
</li>
<li><p class="first">A REFERENCES block to list books or papers (optional). This block serves
a similar purpose to a list of references in a research paper, or a
bibliography in a monograph. If your method, function or class uses an
algorithm that can be found in a standard reference, you should list
that reference under this block. The Sphinx/ReST markup for
citations is described at
<a class="reference external" href="http://sphinx.pocoo.org/rest.html#citations">http://sphinx.pocoo.org/rest.html#citations</a>. See below for an example.
Sage also add specific markup for links to sage trac tickets and
Wikipedia. See <a class="reference internal" href="sage_manuals.html#chapter-sage-manuals-links"><em>Hyperlinks</em></a>. Here&#8217;s an example of a
REFERENCES block:</p>
<div class="highlight-python"><pre>This docstring is referencing [SC]_. Just remember that references
are global, so we can also reference to [Nat2000]_ in the ALGORITHM
block, even if it is in a separate file. However we would not
include the reference here since it would cause a conflict.

REFERENCES:

.. [SC] Conventions for coding in sage.
   http://www.sagemath.org/doc/developer/conventions.html.</pre>
</div>
</li>
</ul>
<p>Use the following template when documenting functions. Note the
indentation</p>
<div class="highlight-python"><pre>def point(self, x=1, y=2):
    r"""
    Return the point `(x^5,y)`.

    INPUT:

    - ``x`` -- integer (default: 1) the description of the
      argument ``x`` goes here.  If it contains multiple lines, all
      the lines after the first need to begin at the same indentation
      as the backtick.

    - ``y`` -- integer (default: 2) the ...

    OUTPUT:

    The point as a tuple.

    .. SEEALSO::

        :func:`line`

    EXAMPLES:

    This example illustrates ...

    ::

        sage: A = ModuliSpace()
        sage: A.point(2,3)
        xxx

    We now ...

    ::

        sage: B = A.point(5,6)
        sage: xxx

    It is an error to ...::

        sage: C = A.point('x',7)
        Traceback (most recent call last):
        ...
        TypeError: unable to convert x (=r) to an integer

    .. NOTE::

        This function uses the algorithm of [BCDT]_ to determine
        whether an elliptic curve `E` over `Q` is modular.

    ...

    REFERENCES:

    .. [BCDT] Breuil, Conrad, Diamond, Taylor,
       "Modularity ...."
    """
    &lt;body of the function&gt;</pre>
</div>
<p>You are strongly encouraged to:</p>
<ul class="simple">
<li>Use nice LaTeX formatting everywhere, see
<a class="reference internal" href="#section-latex-typeset"><em>LaTeX typesetting</em></a>.</li>
<li>Liberally describe what the examples do. Note that there must be a
blank line after the example code and before the explanatory text
for the next example (indentation is not enough).</li>
<li>Illustrate any exceptions raised by the function with examples, as
given above. (It is an error to ...; In particular, use ...)</li>
<li>Include many examples. These are automatically tested on a regular
basis, and are crucial for the quality and adaptability of
Sage. Without such examples, small changes to one part of Sage that
break something else might not go seen until much later when someone
uses the system, which is unacceptable. Note that new functions
without doctests will not be accepted for inclusion in Sage.</li>
</ul>
<p>Functions whose names start with an underscore are considered
private. Hence they do not appear in the reference manual, and their
docstring should not contain any information that is crucial for Sage
users. Having said that, you can explicitly enable their docstrings to
be shown. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">SageObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;usual docstring&gt;</span>

<span class="sd">        .. automethod:: _f</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This would be hidden without the ``.. automethod::``</span>
<span class="sd">         &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>A special case is the constructor <tt class="docutils literal"><span class="pre">__init__</span></tt>, which clearly starts
with an underscore. However, due to its special status the
<tt class="docutils literal"><span class="pre">__init__</span></tt> docstring is used as the class docstring if there is not
one already. That is, you can do the following:</p>
<div class="highlight-python"><pre>sage: class Foo(SageObject):
....:     # no class docstring
....:     def __init__(self):
....:         """Construct a Foo."""
sage: foo = Foo()
sage: from sage.misc.sageinspect import sage_getdoc
sage: sage_getdoc(foo)              # class docstring
'Construct a Foo.\n'
sage: sage_getdoc(foo.__init__)     # constructor docstring
'Construct a Foo.\n'</pre>
</div>
</div>
<div class="section" id="latex-typesetting">
<span id="section-latex-typeset"></span><h3>LaTeX typesetting<a class="headerlink" href="#latex-typesetting" title="Permalink to this headline">¶</a></h3>
<p>In ReST documentation, you use backticks ` to mark LaTeX code to be
typeset.  In Sage docstrings, you may also use dollar signs instead.
Thus <tt class="docutils literal"><span class="pre">`x^2</span> <span class="pre">+</span> <span class="pre">y^2</span> <span class="pre">=</span> <span class="pre">1`</span></tt> and <tt class="docutils literal"><span class="pre">$x^2</span> <span class="pre">+</span> <span class="pre">y^2</span> <span class="pre">=</span> <span class="pre">1$</span></tt> should produce
identical output. If you use TeX commands containing backslashes in
docstrings, then either use double backslashes or place an &#8220;r&#8221; right
before the first triple opening quote. For example, both of the
following are valid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `\\cos(x)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Return $\sin(x)$.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>You can also use the MATH block to format complicated mathematical
expressions:</p>
<div class="highlight-python"><pre>.. MATH::

    \sum_{i=1}^{\infty} (a_1 a_2 \cdots a_i)^{1/i}
    \leq
    e \sum_{i=1}^{\infty} a_i</pre>
</div>
<p>Note that the MATH block is automatically wrapped in a latex math
environment (i.e. in <tt class="docutils literal"><span class="pre">\[</span> <span class="pre">\]</span></tt> or <tt class="docutils literal"><span class="pre">$$</span></tt>, etc.). To use aligned equations,
use the <strong>aligned</strong> environment:</p>
<div class="highlight-python"><pre>.. MATH::

    \begin{aligned}
     f(x) &amp; = x^2 - 1 \\
     g(x) &amp; = x^x - f(x - 2)
    \end{aligned}</pre>
</div>
<p>If you wish to explicitly not wrap the MATH block, make the first line of
the indented block <tt class="docutils literal"><span class="pre">:nowrap:</span></tt>:</p>
<div class="highlight-python"><pre>.. MATH::
    :nowrap:

    This is now plain text so I can do things like $x = 5$.</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">With or without <tt class="docutils literal"><span class="pre">:nowrap:</span></tt>, the <em>html</em> documentation output
currently will work if you use environments such as <strong>align</strong>
which wrap their contents in math mode. However, <tt class="docutils literal"><span class="pre">:nowrap:</span></tt>
is necessary for the <em>pdf</em> documentation to build correctly.</p>
</div>
<p>The Sage LaTeX style is to typeset standard rings and fields like the
integers and the real numbers using the locally-defined macro
<tt class="docutils literal"><span class="pre">\\Bold</span></tt>, as in <tt class="docutils literal"><span class="pre">\\Bold{Z}</span></tt> for the integers. This macro is
defined to be ordinary bold-face <tt class="docutils literal"><span class="pre">\\mathbf</span></tt> by default, but users
can switch to blackboard-bold <tt class="docutils literal"><span class="pre">\\mathbb</span></tt> and back on-the-fly by
using <tt class="docutils literal"><span class="pre">latex.blackboard_bold(True)</span></tt> and
<tt class="docutils literal"><span class="pre">latex.blackboard_bold(False)</span></tt>.</p>
<p>The docstring will be available interactively (for the &#8220;def point...&#8221;
example above, by typing &#8220;point?&#8221; at the &#8220;sage:&#8221; prompt) and also in
the reference manual. When viewed interactively, LaTeX code has the
backslashes stripped from it, so &#8220;\cos&#8221; will appear as &#8220;cos&#8221;.</p>
<p>Because of the dual role of the docstring, you need to strike a
balance between readability (for interactive help) and using perfect
LaTeX code (for the reference manual).  For instance, instead of using
&#8220;\frac{a}{b}&#8221;, use &#8220;a/b&#8221; or maybe &#8220;a b^{-1}&#8221;.  Also keep in mind that
some users of Sage are not familiar with LaTeX; this is another reason
to avoid complicated LaTeX expressions in docstrings, if at all
possible: &#8220;\frac{a}{b}&#8221; will be obscure to someone who doesn&#8217;t know
any LaTeX.</p>
<p>Finally, a few non-standard LaTeX macros are available to help achieve
this balance, including &#8220;\ZZ&#8221;, &#8220;\RR&#8221;, &#8220;\CC&#8221;, and &#8220;\QQ&#8221;.  These are
names of Sage rings, and they are typeset using a single boldface
character; they allow the use of &#8220;\ZZ&#8221; in a docstring, for example,
which will appear interactively as &#8220;ZZ&#8221; while being typeset as
&#8220;\Bold{Z}&#8221; in the reference manual.  Other examples are &#8220;\GF&#8221; and
&#8220;\Zmod&#8221;, each of which takes an argument: &#8220;\GF{q}&#8221; is typeset as
&#8220;\Bold{F}_{q}&#8221; and &#8220;\Zmod{n}&#8221; is typeset as &#8220;\Bold{Z}/n\Bold{Z}&#8221;.
See the file <tt class="docutils literal"><span class="pre">$SAGE_ROOT/src/sage/misc/latex_macros.py</span></tt> for a
full list and for details about how to add more macros.</p>
</div>
<div class="section" id="writing-testable-examples">
<h3>Writing testable examples<a class="headerlink" href="#writing-testable-examples" title="Permalink to this headline">¶</a></h3>
<p>The code in the examples should pass automatic testing. This means
that if the above code is in the file <tt class="docutils literal"><span class="pre">f.py</span></tt> (or <tt class="docutils literal"><span class="pre">f.sage</span></tt>), then
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">f.py</span></tt> should not give any error messages. Testing occurs
with full Sage preparsing of input within the standard Sage shell
environment, as described in <a class="reference internal" href="coding_in_python.html#section-preparsing"><em>Sage Preparsing</em></a>. <strong>Important:</strong>
The file <tt class="docutils literal"><span class="pre">f.py</span></tt> is not imported when running tests unless you have
arranged that it be imported into your Sage environment, i.e. unless
its functions are available when you start Sage using the <tt class="docutils literal"><span class="pre">sage</span></tt>
command. For example, the function <tt class="docutils literal"><span class="pre">AA()</span></tt> in the file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/algebras/steenrod/steenrod_algebra.py</span></tt> includes
an EXAMPLES block containing the following:</p>
<div class="highlight-python"><pre>sage: from sage.algebras.steenrod.steenrod_algebra import AA as A
sage: A()
mod 2 Steenrod algebra, milnor basis</pre>
</div>
<p>Sage does not know about the function <tt class="docutils literal"><span class="pre">AA()</span></tt> by default, so
it needs to be imported before it is tested. Hence the first line in
the example.</p>
<p>When writing documentation, keep the following points in mind:</p>
<ul>
<li><p class="first">All input is preparsed before being passed to Python, e.g. <tt class="docutils literal"><span class="pre">2/3</span></tt>
is replaced by <tt class="docutils literal"><span class="pre">Integer(2)/Integer(3)</span></tt>, which evaluates to <tt class="docutils literal"><span class="pre">2/3</span></tt>
as a rational instead of the Python int <tt class="docutils literal"><span class="pre">0</span></tt>. For more information
on preparsing, see <a class="reference internal" href="coding_in_python.html#section-preparsing"><em>Sage Preparsing</em></a>.</p>
</li>
<li><p class="first">If a test outputs to a file, the file should be a temporary file.
Use <tt class="xref py py-func docutils literal"><span class="pre">tmp_filename()</span></tt> to get a temporary filename, or
<tt class="xref py py-func docutils literal"><span class="pre">tmp_dir()</span></tt> to get a temporary directory.  For example (taken
from the file <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/plot/graphics.py</span></tt>):</p>
<div class="highlight-python"><pre>sage: plot(x^2 - 5, (x, 0, 5), ymin=0).save(tmp_filename(ext='.png'))</pre>
</div>
</li>
<li><p class="first">You may write tests that span multiple lines.  The best way to do so
is to use the line continuation marker <tt class="docutils literal"><span class="pre">....:</span></tt></p>
<div class="highlight-python"><pre>sage: for n in srange(1,10):
....:     if n.is_prime():
....:         print n,
2 3 5 7</pre>
</div>
<p>If you have a long line of code, you may want to consider adding a
backslash to the end of the line, which tells the doctesting
framework to join that current line with the next.  This syntax is
non-standard so may be removed in a future version of Sage, but in
the mean time it can be useful for breaking up large integers across
multiple lines:</p>
<div class="highlight-python"><pre>sage: n = 123456789123456789123456789\
....:     123456789123456789123456789
sage: n.is_prime()
False</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="special-markup-to-influence-tests">
<span id="section-further-conventions"></span><h3>Special markup to influence tests<a class="headerlink" href="#special-markup-to-influence-tests" title="Permalink to this headline">¶</a></h3>
<p>There are a number of magic comments that you can put into the example
code that change how the output is verified by the Sage doctest
framework. Here is a comprehensive list:</p>
<ul>
<li><p class="first">If a test line contains the comment <tt class="docutils literal"><span class="pre">random</span></tt>, it is executed but
it is not checked that the output agrees with the output in the
documentation string. For example, the docstring for the
<tt class="docutils literal"><span class="pre">__hash__</span></tt> method for <tt class="docutils literal"><span class="pre">CombinatorialObject</span></tt> in
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/combinat/combinat.py</span></tt> includes the lines:</p>
<div class="highlight-python"><pre>sage: c = CombinatorialObject([1,2,3])
sage: hash(c)   # random
1335416675971793195
sage: c.__hash__()   # random
1335416675971793195</pre>
</div>
<p>However, most functions generating pseudorandom output do not need
this tag since the doctesting framework guarantees the state of the
pseudorandom number generators (PRNGs) used in Sage for a given
doctest. See <a class="reference internal" href="#chapter-randomtesting"><em>Randomized testing</em></a> for details on this
framework.</p>
</li>
<li><p class="first">If a line contains the comment <tt class="docutils literal"><span class="pre">long</span> <span class="pre">time</span></tt> then that line is not
tested unless the <tt class="docutils literal"><span class="pre">--long</span></tt> option is given, e.g.  <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--long</span>
<span class="pre">f.py</span></tt>. Use this to include examples that take more than about a
second to run. These will not be run regularly during Sage
development, but will get run before major releases. No example
should take more than about 30 seconds.</p>
<p>For instance, here is part of the docstring from the <tt class="docutils literal"><span class="pre">regulator</span></tt>
method for rational elliptic curves, from the file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/devel/sage/sage/schemes/elliptic_curves/ell_rational.py</span></tt>:</p>
<div class="highlight-python"><pre>sage: E = EllipticCurve([0, 0, 1, -1, 0])
sage: E.regulator()        # long time (1 second)
0.0511114082399688</pre>
</div>
</li>
<li><p class="first">If a comment contains <tt class="docutils literal"><span class="pre">tol</span></tt> or <tt class="docutils literal"><span class="pre">tolerance</span></tt>, numerical results are
only verified to the given tolerance. This may be prefixed by
<tt class="docutils literal"><span class="pre">abs[olute]</span></tt> or <tt class="docutils literal"><span class="pre">rel[ative]</span></tt> to specify whether to measure
absolute or relative error; this defaults to relative error except
when the expected value is exactly zero:</p>
<div class="highlight-python"><pre>sage: RDF(pi)                               # abs tol 1e-5
3.14159
sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4
[0.9999, 10.001, 100.01, 999.9, 10001]</pre>
</div>
<p>This can be useful when the exact output is subject to rounding
error and/or processor floating point arithmetic variation.  Here
are some more examples.</p>
<p>A singular value decomposition of a matrix will produce two unitary
matrices.  Over the reals, this means the inverse of the matrix is
equal to its transpose.  We test this result by applying the norm to
a matrix difference.  The result will usually be a &#8220;small&#8221; number,
distinct from zero:</p>
<div class="highlight-python"><pre>sage: A = matrix(RDF, 8, range(64))
sage: U, S, V = A.SVD()
sage: (U.transpose()*U-identity_matrix(8)).norm(p=2)    # abs tol 1e-10
0.0</pre>
</div>
<p>The 8-th cyclotomic field is generated by the complex number
<span class="math">\(e^\frac{i\pi}{4}\)</span>.  Here we compute a numerical approximation:</p>
<div class="highlight-python"><pre>sage: K.&lt;zeta8&gt; = CyclotomicField(8)
sage: N(zeta8)                             # absolute tolerance 1e-10
0.7071067812 + 0.7071067812*I</pre>
</div>
<p>A relative tolerance on a root of a polynomial.  Notice that the
root should normally print as <tt class="docutils literal"><span class="pre">1e+16</span></tt>, or something similar.
However, the tolerance testing causes the doctest framework to use
the output in a <em>computation</em>, so other valid text representations
of the predicted value may be used.  However, they must fit the
pattern defined by the regular expression <tt class="docutils literal"><span class="pre">float_regex</span></tt> in
<tt class="xref py py-mod docutils literal"><span class="pre">sage.doctest.parsing</span></tt>:</p>
<div class="highlight-python"><pre>sage: y = polygen(RDF, 'y')
sage: p = (y - 10^16)*(y-10^(-13))*(y-2); p
y^3 - 1e+16*y^2 + 2e+16*y - 2000.0
sage: p.roots(multiplicities=False)[2]     # relative tol 1e-10
10000000000000000</pre>
</div>
</li>
<li><p class="first">If a comment contains <tt class="docutils literal"><span class="pre">not</span> <span class="pre">implemented</span></tt> or <tt class="docutils literal"><span class="pre">not</span> <span class="pre">tested</span></tt>, it is
never tested. It is good to include lines like this to make clear
what we want Sage to eventually implement:</p>
<div class="highlight-python"><pre>sage: factor(x*y - x*z)    # todo: not implemented</pre>
</div>
<p>It is also immediately clear to the user that the indicated example
does not currently work.</p>
</li>
<li><p class="first">If one of the first 10 lines of a file starts with <tt class="docutils literal"><span class="pre">r&quot;&quot;&quot;</span>
<span class="pre">nodoctest</span></tt> (or <tt class="docutils literal"><span class="pre">&quot;&quot;&quot;</span> <span class="pre">nodoctest</span></tt> or <tt class="docutils literal"><span class="pre">#</span> <span class="pre">nodoctest</span></tt> or <tt class="docutils literal"><span class="pre">%</span>
<span class="pre">nodoctest</span></tt> or <tt class="docutils literal"><span class="pre">..</span> <span class="pre">nodoctest</span></tt>, or any of these with different
spacing), then that file will be skipped.  If a directory contains a
file <tt class="docutils literal"><span class="pre">nodoctest.py</span></tt>, then that whole directory will be
skipped. Neither of this applies to files or directories which are
explicitly given as command line arguments: those are always tested.</p>
</li>
<li><p class="first">If a comment contains <tt class="docutils literal"><span class="pre">optional</span> <span class="pre">-</span> <span class="pre">PKGNAME</span></tt>, it is not tested
unless the <tt class="docutils literal"><span class="pre">--optional=PKGNAME</span></tt> flag is passed to <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span></tt>.
Mark a doctest as <tt class="docutils literal"><span class="pre">optional</span></tt> if it requires optional packages.
Running <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--optional=all</span> <span class="pre">f.py</span></tt> executes all doctests,
including all optional tests.  Running
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--optional=sage,sloane_database</span> <span class="pre">f.py</span></tt> runs the normal
tests (because of <tt class="docutils literal"><span class="pre">--optional=sage</span></tt>), as well as those marked as
<tt class="docutils literal"><span class="pre">#</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">sloane_database</span></tt>.  For example, the file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/databases/sloane.py</span></tt> contains the lines:</p>
<div class="highlight-python"><pre>sage: sloane_sequence(60843)       # optional - internet</pre>
</div>
<p>and:</p>
<div class="highlight-python"><pre>sage: SloaneEncyclopedia[60843]    # optional - sloane_database</pre>
</div>
<p>The first of these just needs internet access, while the second
requires that the &#8220;sloane_database&#8221; package be installed.  Calling
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--optional=all</span></tt> on this file runs both of these tests,
while calling <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--optional=sage,internet</span></tt> on it will only
run the first test.  A test requiring several packages should be
marked <tt class="docutils literal"><span class="pre">#</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">pkg1</span> <span class="pre">pkg2</span></tt> and executed by
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--optional=sage,pkg1,pkg2</span> <span class="pre">f.py</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any words after <tt class="docutils literal"><span class="pre">#</span> <span class="pre">optional</span></tt> are interpreted as a list of
package names, separated by spaces.  Any punctuation (periods,
commas, hyphens, semicolons, ...)  after the first word ends the
list of packages.  Hyphens or colons between the word
<tt class="docutils literal"><span class="pre">optional</span></tt> and the first package name are allowed.  Therefore,
you should not write <tt class="docutils literal"><span class="pre">optional:</span> <span class="pre">needs</span> <span class="pre">package</span> <span class="pre">CHomP</span></tt> but
simply <tt class="docutils literal"><span class="pre">optional:</span> <span class="pre">CHomP</span></tt>.  Optional tags are case-insensitive,
so you could also write <tt class="docutils literal"><span class="pre">optional:</span> <span class="pre">cHoMp</span></tt>.</p>
</div>
</li>
<li><p class="first">If you are documenting a known bug in Sage, mark it as <tt class="docutils literal"><span class="pre">known</span> <span class="pre">bug</span></tt>
or <tt class="docutils literal"><span class="pre">optional:</span> <span class="pre">bug</span></tt>.  For example:</p>
<div class="highlight-python"><pre>The following should yield 4.  See :trac:`2`. ::

    sage: 2+2  # optional: bug
    5</pre>
</div>
<p>Then the doctest will be skipped by default, but could be revealed
by running <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--optional=sage,bug</span> <span class="pre">...</span></tt>.  (A doctest marked
as <tt class="docutils literal"><span class="pre">known</span> <span class="pre">bug</span></tt> gets automatically converted to <tt class="docutils literal"><span class="pre">optional</span> <span class="pre">bug</span></tt>).</p>
</li>
<li><p class="first">Some tests (hashing for example) behave differently on 32-bit and
64-bit platforms.  You can mark a line (generally the output) with
either <tt class="docutils literal"><span class="pre">#</span> <span class="pre">32-bit</span></tt> or <tt class="docutils literal"><span class="pre">#</span> <span class="pre">64-bit</span></tt> and the testing framework will
remove any lines that don&#8217;t match the current architecture.  For
example:</p>
<div class="highlight-python"><pre>sage: z = 32
sage: z.powermodm_ui(2^32-1, 14)
Traceback (most recent call last):                              # 32-bit
...                                                             # 32-bit
OverflowError: exp (=4294967295) must be &lt;= 4294967294          # 32-bit
8              # 64-bit</pre>
</div>
</li>
</ul>
<p>Using <tt class="docutils literal"><span class="pre">search_src</span></tt> from the Sage prompt (or <tt class="docutils literal"><span class="pre">grep</span></tt>), one can
easily find the aforementioned keywords. In the case of <tt class="docutils literal"><span class="pre">todo:</span> <span class="pre">not</span>
<span class="pre">implemented</span></tt>, one can use the results of such a search to direct
further development on Sage.</p>
</div>
</div>
<div class="section" id="running-automated-tests">
<span id="chapter-testing"></span><h2>Running automated tests<a class="headerlink" href="#running-automated-tests" title="Permalink to this headline">¶</a></h2>
<p>This section describes Sage&#8217;s automated testing of test files of the
following types: <tt class="docutils literal"><span class="pre">.py</span></tt>, <tt class="docutils literal"><span class="pre">.pyx</span></tt>, <tt class="docutils literal"><span class="pre">.sage</span></tt>, <tt class="docutils literal"><span class="pre">.rst</span></tt>. Briefly, use
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;file&gt;</span></tt> to test that the examples in <tt class="docutils literal"><span class="pre">&lt;file&gt;</span></tt> behave
exactly as claimed. See the following subsections for more
details. See also <a class="reference internal" href="#section-docstrings"><em>Documentation strings</em></a> for a discussion on how to
include examples in documentation strings and what conventions to
follow. The chapter <a class="reference internal" href="doctesting.html#chapter-doctesting"><em>Doctesting the Sage Library</em></a> contains a tutorial on
doctesting modules in the Sage library.</p>
<div class="section" id="testing-py-pyx-and-sage-files">
<span id="section-testpython"></span><h3>Testing .py, .pyx and .sage files<a class="headerlink" href="#testing-py-pyx-and-sage-files" title="Permalink to this headline">¶</a></h3>
<p>Run <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;filename.py&gt;</span></tt> to test all code examples in
<tt class="docutils literal"><span class="pre">filename.py</span></tt>. Similar remarks apply to <tt class="docutils literal"><span class="pre">.sage</span></tt> and <tt class="docutils literal"><span class="pre">.pyx</span></tt>
files:</p>
<div class="highlight-python"><pre>sage -t [--verbose] [--optional]  [files and directories ... ]</pre>
</div>
<p>The Sage doctesting framework is based on the standard Python doctest
module, but with many additional features (such as parallel testing,
timeouts, optional tests).  The Sage doctester recognizes <tt class="docutils literal"><span class="pre">sage:</span></tt>
prompts as well as <tt class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></tt> prompts.  It also preparses the doctests,
just like in interactive Sage sessions.</p>
<p>Your file passes the tests if the code in it will run when entered
at the <tt class="docutils literal"><span class="pre">sage:</span></tt> prompt with no extra imports. Thus users are
guaranteed to be able to exactly copy code out of the examples you
write for the documentation and have them work.</p>
<p>For more information, see <a class="reference internal" href="doctesting.html#chapter-doctesting"><em>Doctesting the Sage Library</em></a>.</p>
</div>
<div class="section" id="testing-rest-documentation">
<h3>Testing ReST documentation<a class="headerlink" href="#testing-rest-documentation" title="Permalink to this headline">¶</a></h3>
<p>Run <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;filename.rst&gt;</span></tt> to test the examples in verbatim
environments in ReST documentation.</p>
<p>Of course in ReST files, one often inserts explanatory texts between
different verbatim environments. To link together verbatim
environments, use the <tt class="docutils literal"><span class="pre">..</span> <span class="pre">link</span></tt> comment. For example:</p>
<div class="highlight-python"><pre>EXAMPLES::

        sage: a = 1


Next we add 1 to ``a``.

.. link::

        sage: 1 + a
        2</pre>
</div>
<p>If you want to link all the verbatim environments together, you can
put <tt class="docutils literal"><span class="pre">..</span> <span class="pre">linkall</span></tt> anywhere in the file, on a line by itself.  (For
clarity, it might be best to put it near the top of the file.)  Then
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span></tt> will act as if there were a <tt class="docutils literal"><span class="pre">..</span> <span class="pre">link</span></tt> before each
verbatim environment.  The file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/devel/sage/doc/en/tutorial/interfaces.rst</span></tt> contains a
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">linkall</span></tt> directive, for example.</p>
<p>You can also put <tt class="docutils literal"><span class="pre">..</span> <span class="pre">skip</span></tt> right before a verbatim environment to
have that example skipped when testing the file.  This goes in the
same place as the <tt class="docutils literal"><span class="pre">..</span> <span class="pre">link</span></tt> in the previous example.</p>
<p>See the files in <tt class="docutils literal"><span class="pre">SAGE_ROOT/devel/sage/doc/en/tutorial/</span></tt> for many
examples of how to include automated testing in ReST documentation for
Sage.</p>
</div>
</div>
<div class="section" id="the-pickle-jar">
<span id="chapter-picklejar"></span><h2>The Pickle Jar<a class="headerlink" href="#the-pickle-jar" title="Permalink to this headline">¶</a></h2>
<p>Sage maintains a pickle jar at
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/ext/pickle_jar/pickle_jar.tar.bz2</span></tt> which is a tar
file of &#8220;standard&#8221; pickles created by <tt class="docutils literal"><span class="pre">sage</span></tt>. This pickle jar is
used to ensure that sage maintains backward compatibility by have
having <tt class="xref py py-func docutils literal"><span class="pre">sage.structure.sage_object.unpickle_all()</span></tt> check that
<tt class="docutils literal"><span class="pre">sage</span></tt> can always unpickle all of the pickles in the pickle jar as
part of the standard doc testing framework.</p>
<p>Most people first become aware of the pickle_jar when their patch breaks the
unpickling of one of the &#8220;standard&#8221; pickles in the pickle jar due to the
failure of the doctest:</p>
<div class="highlight-python"><pre>sage -t devel/sage-main/sage/structure/sage_object.pyx</pre>
</div>
<p>When this happens an error message is printed which contains the following
hints for fixing the uneatable pickle:</p>
<div class="highlight-python"><pre>----------------------------------------------------------------------
** This error is probably due to an old pickle failing to unpickle.
** See sage.structure.sage_object.register_unpickle_override for
** how to override the default unpickling methods for (old) pickles.
** NOTE: pickles should never be removed from the pickle_jar!
----------------------------------------------------------------------</pre>
</div>
<p>For more details about how to fix unpickling errors in the pickle jar
see <tt class="xref py py-func docutils literal"><span class="pre">sage.structure.sage_object.register_unpickle_override()</span></tt></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Sage&#8217;s pickle jar helps to ensure backward compatibility in sage. Pickles should
<strong>only</strong> be removed from the pickle jar after the corresponding objects
have been properly deprecated. Any proposal to remove pickles from the
pickle jar should first be discussed on sage-devel.</p>
</div>
</div>
<div class="section" id="randomized-testing">
<span id="chapter-randomtesting"></span><h2>Randomized testing<a class="headerlink" href="#randomized-testing" title="Permalink to this headline">¶</a></h2>
<p>In addition to all the examples in your docstrings, which serve as
both demonstrations and tests of your code, you should consider
creating a test suite. Think of this as a program that will run for a
while and &#8220;tries&#8221; to crash your code using randomly generated
input. Your test code should define a class <tt class="docutils literal"><span class="pre">Test</span></tt> with a
<tt class="docutils literal"><span class="pre">random()</span></tt> method that runs random tests. These are all assembled
together later, and each test is run for a certain amount of time on a
regular basis.</p>
<p>For an example, see the file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/modular/modsym/tests.py</span></tt>.</p>
</div>
<div class="section" id="global-options">
<h2>Global Options<a class="headerlink" href="#global-options" title="Permalink to this headline">¶</a></h2>
<p>Global options for classes can be defined in Sage using
<tt class="xref py py-class docutils literal"><span class="pre">GlobalOptions</span></tt>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">General Conventions</a><ul>
<li><a class="reference internal" href="#python-code-style">Python Code Style</a></li>
<li><a class="reference internal" href="#files-and-directory-structure">Files and Directory Structure</a></li>
<li><a class="reference internal" href="#an-example-is-worth-a-thousand-words">An example is worth a thousand words</a></li>
<li><a class="reference internal" href="#headings-of-sage-library-code-files">Headings of Sage library code files</a></li>
<li><a class="reference internal" href="#documentation-strings">Documentation strings</a><ul>
<li><a class="reference internal" href="#docstring-markup-with-rest-and-sphinx">Docstring markup with ReST and Sphinx</a></li>
<li><a class="reference internal" href="#latex-typesetting">LaTeX typesetting</a></li>
<li><a class="reference internal" href="#writing-testable-examples">Writing testable examples</a></li>
<li><a class="reference internal" href="#special-markup-to-influence-tests">Special markup to influence tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-automated-tests">Running automated tests</a><ul>
<li><a class="reference internal" href="#testing-py-pyx-and-sage-files">Testing .py, .pyx and .sage files</a></li>
<li><a class="reference internal" href="#testing-rest-documentation">Testing ReST documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-pickle-jar">The Pickle Jar</a></li>
<li><a class="reference internal" href="#randomized-testing">Randomized testing</a></li>
<li><a class="reference internal" href="#global-options">Global Options</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="trac.html"
                                  title="previous chapter">The Sage Trac Server</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="coding_in_python.html"
                                  title="next chapter">Coding in Python for Sage</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/coding_basics.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="coding_in_python.html" title="Coding in Python for Sage"
             >next</a> |</li>
        <li class="right" >
          <a href="trac.html" title="The Sage Trac Server"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v1.0</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2013, The Sage Development Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;  
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');
    
    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });
    
    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();
    
    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };
    
    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });
    
    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>