
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Coding using external libraries and interfaces &mdash; Sage Developer&#39;s Guide v6.0</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v6.0" href="index.html" />
    <link rel="up" title="Writing Code for Sage" href="writing_code.html" />
    <link rel="next" title="Doctesting the Sage Library" href="doctesting.html" />
    <link rel="prev" title="Coding in Cython" href="coding_in_cython.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="doctesting.html" title="Doctesting the Sage Library"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="coding_in_cython.html" title="Coding in Cython"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v6.0</a> &raquo;</li>

          <li><a href="writing_code.html" accesskey="U">Writing Code for Sage</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="coding-using-external-libraries-and-interfaces">
<span id="chapter-other"></span><h1>Coding using external libraries and interfaces<a class="headerlink" href="#coding-using-external-libraries-and-interfaces" title="Permalink to this headline">¶</a></h1>
<p>When writing code for Sage, use Python for the basic structure and
interface. For speed, efficiency, or convenience, you can implement
parts of the code using any of the following languages:
<a class="reference internal" href="coding_in_cython.html#chapter-cython"><em>Cython</em></a>, C/C++,
Fortran 95, GAP, Common Lisp, Singular, and PARI/GP. You can also use
all C/C++ libraries included with Sage  <a class="footnote-reference" href="#id2" id="id1">[3]</a>. (And if you are okay
with your code depending on optional Sage packages, you can use
Octave, or even Magma, Mathematica, or Maple.)</p>
<p>In this chapter, we discuss interfaces between Sage and
<a class="reference internal" href="#section-pari-library"><em>PARI</em></a>, <a class="reference internal" href="#section-gap"><em>GAP</em></a> and <a class="reference internal" href="#section-singular"><em>Singular</em></a>.</p>
<div class="section" id="the-pari-c-library-interface">
<span id="section-pari-library"></span><h2>The PARI C library interface<a class="headerlink" href="#the-pari-c-library-interface" title="Permalink to this headline">¶</a></h2>
<p>(This chapter was written by Martin Albrecht.)</p>
<p>Here is a step-by-step guide to adding new PARI functions to Sage. We
use the Frobenius form of a matrix as an example.</p>
<p>Some heavy lifting for matrices over integers is implemented using
the PARI library. To compute the Frobenius form in PARI, the
<tt class="docutils literal"><span class="pre">matfrobenius</span></tt> function is used.</p>
<p>There are two ways to interact with the PARI library from Sage. The
gp interface uses the gp interpreter. The PARI interface uses
direct calls to the PARI C functions&#8212;this is the preferred way
as it is much faster. Thus this section focuses on using PARI.</p>
<p>We will add a new method to the <tt class="docutils literal"><span class="pre">gen</span></tt> class. This is the abstract
representation of all PARI library objects. That means that once we
add a method to this class, every PARI object, whether it is a number,
polynomial or matrix, will have our new method. So you can do
<tt class="docutils literal"><span class="pre">pari(1).matfrobenius()</span></tt>, but since PARI wants to apply
<tt class="docutils literal"><span class="pre">matfrobenius</span></tt> to matrices, not numbers, you will receive a
<tt class="docutils literal"><span class="pre">PariError</span></tt> in this case.</p>
<p>The <tt class="docutils literal"><span class="pre">gen</span></tt> class is defined in
<tt class="file docutils literal"><span class="pre">SAGE_ROOT/devel/sage/sage/libs/pari/gen.pyx</span></tt>, and this is where we
add the method <tt class="docutils literal"><span class="pre">matfrobenius</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">matfrobenius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    M.matfrobenius(flag=0): Return the Frobenius form of the square</span>
<span class="sd">    matrix M. If flag is 1, return only the elementary divisors (a list</span>
<span class="sd">    of polynomials). If flag is 2, return a two-components vector [F,B]</span>
<span class="sd">    where F is the Frobenius form and B is the basis change so that</span>
<span class="sd">    `M=B^{-1} F B`.</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: a = pari(&#39;[1,2;3,4]&#39;)</span>
<span class="sd">        sage: a.matfrobenius()</span>
<span class="sd">        [0, 2; 1, 5]</span>
<span class="sd">        sage: a.matfrobenius(flag=1)</span>
<span class="sd">        [x^2 - 5*x - 2]</span>
<span class="sd">        sage: a.matfrobenius(2)</span>
<span class="sd">        [[0, 2; 1, 5], [1, -1/3; 0, 1/3]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sig_on</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_gen</span><span class="p">(</span><span class="n">matfrobenius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Note the use of the <a class="reference internal" href="coding_in_cython.html#section-sig-on"><em>sig_on() statement</em></a>.</p>
<p>The <tt class="docutils literal"><span class="pre">matfrobenius</span></tt> call is just a call
to the PARI C library function <tt class="docutils literal"><span class="pre">matfrobenius</span></tt> with the appropriate
parameters.</p>
<p>The <tt class="docutils literal"><span class="pre">self.new_gen(GEN</span> <span class="pre">x)</span></tt> call constructs a new Sage <tt class="docutils literal"><span class="pre">gen</span></tt> object from a
given PARI <tt class="docutils literal"><span class="pre">GEN</span></tt> where the PARI <tt class="docutils literal"><span class="pre">GEN</span></tt> is stored as the
<tt class="docutils literal"><span class="pre">.g</span></tt> attribute.
Apart from this, <tt class="docutils literal"><span class="pre">self.new_gen()</span></tt> calls a closing <tt class="docutils literal"><span class="pre">sig_off()</span></tt> macro
and also clears the PARI stack so it is very convenient to use in a
<tt class="docutils literal"><span class="pre">return</span></tt> statement as illustrated above.
So after <tt class="docutils literal"><span class="pre">self.new_gen()</span></tt>, all PARI <tt class="docutils literal"><span class="pre">GEN</span></tt>&#8216;s which are not converted
to Sage <tt class="docutils literal"><span class="pre">gen</span></tt>&#8216;s are gone.
There is also <tt class="docutils literal"><span class="pre">self.new_gen_noclear(GEN</span> <span class="pre">x)</span></tt> which does the same as
<tt class="docutils literal"><span class="pre">self.new_gen(GEN</span> <span class="pre">x)</span></tt> except that it does <em>not</em> call <tt class="docutils literal"><span class="pre">sig_off()</span></tt> nor
clear the PARI stack.</p>
<p>The information about which function to call and how to call it can be
retrieved from the PARI user&#8217;s manual (note: Sage includes the
development version of PARI, so check that version of the user&#8217;s
manual). Looking for <tt class="docutils literal"><span class="pre">matfrobenius</span></tt> you can find:</p>
<blockquote>
<div>The library syntax is <tt class="docutils literal"><span class="pre">GEN</span> <span class="pre">matfrobenius(GEN</span> <span class="pre">M,</span> <span class="pre">long</span> <span class="pre">flag,</span> <span class="pre">long</span> <span class="pre">v</span> <span class="pre">=</span> <span class="pre">-1)</span></tt>,
where <tt class="docutils literal"><span class="pre">v</span></tt> is a variable number.</div></blockquote>
<p>In case you are familiar with gp, please note that the PARI C function
may have a name that is different from the corresponding gp function
(for example, see <tt class="docutils literal"><span class="pre">mathnf</span></tt>), so always check the manual.</p>
<p>We can also add a <tt class="docutils literal"><span class="pre">frobenius(flag)</span></tt> method to the <tt class="docutils literal"><span class="pre">matrix_integer</span></tt>
class where we call the <tt class="docutils literal"><span class="pre">matfrobenius()</span></tt> method on the PARI object
associated to the matrix after doing some sanity checking. Then we
convert output from PARI to Sage objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">frobenius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the Frobenius form (rational canonical form) of this</span>
<span class="sd">    matrix.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    -  ``flag`` -- 0 (default), 1 or 2 as follows:</span>

<span class="sd">        -  ``0`` -- (default) return the Frobenius form of this</span>
<span class="sd">           matrix.</span>

<span class="sd">        -  ``1`` -- return only the elementary divisor</span>
<span class="sd">           polynomials, as polynomials in var.</span>

<span class="sd">        -  ``2`` -- return a two-components vector [F,B] where F</span>
<span class="sd">           is the Frobenius form and B is the basis change so that</span>
<span class="sd">           `M=B^{-1}FB`.</span>

<span class="sd">    -  ``var`` -- a string (default: &#39;x&#39;)</span>

<span class="sd">    ALGORITHM: uses PARI&#39;s matfrobenius()</span>

<span class="sd">    EXAMPLES::</span>

<span class="sd">        sage: A = MatrixSpace(ZZ, 3)(range(9))</span>
<span class="sd">        sage: A.frobenius(0)</span>
<span class="sd">        [ 0  0  0]</span>
<span class="sd">        [ 1  0 18]</span>
<span class="sd">        [ 0  1 12]</span>
<span class="sd">        sage: A.frobenius(1)</span>
<span class="sd">        [x^3 - 12*x^2 - 18*x]</span>
<span class="sd">        sage: A.frobenius(1, var=&#39;y&#39;)</span>
<span class="sd">        [y^3 - 12*y^2 - 18*y]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_square</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s">&quot;frobenius matrix of non-square matrix not defined.&quot;</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pari_</span><span class="p">()</span><span class="o">.</span><span class="n">matfrobenius</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_space</span><span class="p">()(</span><span class="n">v</span><span class="o">.</span><span class="n">python</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">flag</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ring</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
        <span class="n">retr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">retr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;^&quot;</span><span class="p">,</span><span class="s">&quot;**&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="n">r</span><span class="o">.</span><span class="n">gen</span><span class="p">()},</span> <span class="n">r</span><span class="o">.</span><span class="n">gens_dict</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">retr</span>
    <span class="k">elif</span> <span class="n">flag</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">matrix_space</span><span class="o">.</span><span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">())(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">python</span><span class="p">())</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">matrix_space</span><span class="o">.</span><span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">())(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">python</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">F</span><span class="p">,</span> <span class="n">B</span>
</pre></div>
</div>
</div>
<div class="section" id="gap">
<span id="section-gap"></span><h2>GAP<a class="headerlink" href="#gap" title="Permalink to this headline">¶</a></h2>
<p>(The first version of this chapter was written by David Joyner.)</p>
<p>Wrapping a GAP function in Sage is a matter of writing a program in
Python that uses the pexpect interface to pipe various commands to GAP
and read back the input into Sage. This is sometimes easy, sometimes
hard.</p>
<p>For example, suppose we want to make a wrapper for the computation of
the Cartan matrix of a simple Lie algebra. The Cartan matrix of <span class="math">\(G_2\)</span>
is available in GAP using the commands</p>
<div class="highlight-python"><pre>gap&gt; L:= SimpleLieAlgebra( "G", 2, Rationals );
&lt;Lie algebra of dimension 14 over Rationals&gt;
gap&gt; R:= RootSystem( L );
&lt;root system of rank 2&gt;
gap&gt; CartanMatrix( R );</pre>
</div>
<p>(Incidentally, most of the GAP Lie algebra implementation was written
by Thomas Breuer, Willem de Graaf and Craig Struble.)</p>
<p>In Sage, one can access these commands by typing</p>
<div class="highlight-python"><pre>sage: L = gap.SimpleLieAlgebra('"G"', 2, 'Rationals'); L
Algebra( Rationals, [ v.1, v.2, v.3, v.4, v.5, v.6, v.7, v.8, v.9, v.10,
  v.11, v.12, v.13, v.14 ] )
sage: R = L.RootSystem(); R
&lt;root system of rank 2&gt;
sage: R.CartanMatrix()
[ [ 2, -1 ], [ -3, 2 ] ]</pre>
</div>
<p>Note the <tt class="docutils literal"><span class="pre">'&quot;G&quot;'</span></tt> which is evaluated in GAP as the string <tt class="docutils literal"><span class="pre">&quot;G&quot;</span></tt>.</p>
<p>The purpose of this section is to use this example to show how one
might write a Python/Sage program whose input is, say, <tt class="docutils literal"><span class="pre">('G',2)</span></tt> and
whose output is the matrix above (but as a Sage Matrix&#8212;see the code
in the directory <tt class="file docutils literal"><span class="pre">SAGE_ROOT/devel/sage/sage/matrix/</span></tt> and the
corresponding parts of the Sage reference manual).</p>
<p>First, the input must be converted into strings consisting of legal
GAP commands. Then the GAP output, which is also a string, must be
parsed and converted if possible to a corresponding Sage/Python
object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cartan_matrix</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the Cartan matrix of given Chevalley type and rank.</span>

<span class="sd">    INPUT:</span>
<span class="sd">        type -- a Chevalley letter name, as a string, for</span>
<span class="sd">                a family type of simple Lie algebras</span>
<span class="sd">        rank -- an integer (legal for that type).</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: cartan_matrix(&quot;A&quot;,5)</span>
<span class="sd">        [ 2 -1  0  0  0]</span>
<span class="sd">        [-1  2 -1  0  0]</span>
<span class="sd">        [ 0 -1  2 -1  0]</span>
<span class="sd">        [ 0  0 -1  2 -1]</span>
<span class="sd">        [ 0  0  0 -1  2]</span>
<span class="sd">        sage: cartan_matrix(&quot;G&quot;,2)</span>
<span class="sd">        [ 2 -1]</span>
<span class="sd">        [-3  2]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">L</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">SimpleLieAlgebra</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span><span class="o">%</span><span class="nb">type</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="s">&#39;Rationals&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">RootSystem</span><span class="p">()</span>
    <span class="n">sM</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">CartanMatrix</span><span class="p">()</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sM</span><span class="p">))</span>
    <span class="n">MS</span>  <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MS</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</pre></div>
</div>
<p>The output <tt class="docutils literal"><span class="pre">ans</span></tt> is a Python list. The last two lines convert that
list to an instance of the Sage class <tt class="docutils literal"><span class="pre">Matrix</span></tt>.</p>
<p>Alternatively, one could replace the first line of the above function
with this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;SimpleLieAlgebra(&quot;</span><span class="si">%s</span><span class="s">&quot;, </span><span class="si">%s</span><span class="s">, Rationals);&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">rank</span><span class="p">))</span>
</pre></div>
</div>
<p>Defining &#8220;easy&#8221; and &#8220;hard&#8221; is subjective, but here is one definition.
Wrapping a GAP function is &#8220;easy&#8221; if there is already a corresponding
class in Python or Sage for the output data type of the GAP function
you are trying to wrap. For example, wrapping any GUAVA (GAP&#8217;s
error-correcting codes package) function is &#8220;easy&#8221; since
error-correcting codes are vector spaces over finite fields and GUAVA
functions return one of the following data types:</p>
<ul class="simple">
<li>vectors over finite fields,</li>
<li>polynomials over finite fields,</li>
<li>matrices over finite fields,</li>
<li>permutation groups or their elements,</li>
<li>integers.</li>
</ul>
<p>Sage already has classes for each of these.</p>
<p>A &#8220;hard&#8221; example is left as an exercise! Here are a few ideas.</p>
<ul class="simple">
<li>Write a wrapper for GAP&#8217;s <tt class="docutils literal"><span class="pre">FreeLieAlgebra</span></tt> function (or, more
generally, all the finitely presented Lie algebra functions in
GAP). This would require creating new Python objects.</li>
<li>Write a wrapper for GAP&#8217;s <tt class="docutils literal"><span class="pre">FreeGroup</span></tt> function (or, more
generally, all the finitely presented groups functions in GAP). This
would require writing some new Python objects.</li>
<li>Write a wrapper for GAP&#8217;s character tables. Though this could be
done without creating new Python objects, to make the most use of
these tables, it probably would be best to have new Python objects
for this.</li>
</ul>
</div>
<div class="section" id="singular">
<span id="section-singular"></span><h2>Singular<a class="headerlink" href="#singular" title="Permalink to this headline">¶</a></h2>
<p>(The first version of this chapter was written by David Joyner.)</p>
<p>Using Singular functions from Sage is not much different conceptually
from using GAP functions from Sage. As with GAP, this can range from
easy to hard, depending on how much of the data structure of the
output of the Singular function is already present in Sage.</p>
<p>First, some terminology. For us, a <em>curve</em> <span class="math">\(X\)</span> over a finite field <span class="math">\(F\)</span>
is an equation of the form <span class="math">\(f(x,y) = 0\)</span>, where <span class="math">\(f \in F[x,y]\)</span> is a
polynomial. It may or may not be singular. A <em>place of degree</em> <span class="math">\(d\)</span> is
a Galois orbit of <span class="math">\(d\)</span> points in <span class="math">\(X(E)\)</span>, where <span class="math">\(E/F\)</span> is of degree
<span class="math">\(d\)</span>. For example, a place of degree <span class="math">\(1\)</span> is also a place of degree <span class="math">\(3\)</span>,
but a place of degree <span class="math">\(2\)</span> is not since no degree <span class="math">\(3\)</span> extension of <span class="math">\(F\)</span>
contains a degree <span class="math">\(2\)</span> extension. Places of degree <span class="math">\(1\)</span> are also called
<span class="math">\(F\)</span>-rational points.</p>
<p>As an example of the Sage/Singular interface, we will explain how to
wrap Singular&#8217;s <tt class="docutils literal"><span class="pre">NSplaces</span></tt>, which computes places on a curve over a
finite field. (The command <tt class="docutils literal"><span class="pre">closed_points</span></tt> also does this in some
cases.) This is &#8220;easy&#8221; since no new Python classes are needed in Sage
to carry this out.</p>
<p>Here is an example on how to use this command in Singular:</p>
<div class="highlight-python"><pre> A Computer Algebra System for Polynomial Computations   /   version 3-0-0
                                                       0&lt;
     by: G.-M. Greuel, G. Pfister, H. Schoenemann        \   May 2005
FB Mathematik der Universitaet, D-67653 Kaiserslautern    \
&gt; LIB "brnoeth.lib";
[...]
&gt; ring s=5,(x,y),lp;
&gt; poly f=y^2-x^9-x;
&gt; list X1=Adj_div(f);
Computing affine singular points ...
Computing all points at infinity ...
Computing affine singular places ...
Computing singular places at infinity ...
Computing non-singular places at infinity ...
Adjunction divisor computed successfully

The genus of the curve is 4
&gt; list X2=NSplaces(1,X1);
Computing non-singular affine places of degree 1 ...
&gt; list X3=extcurve(1,X2);

Total number of rational places : 6

&gt; def R=X3[1][5];
&gt; setring R;
&gt; POINTS;
[1]:
   [1]:
      0
   [2]:
      1
   [3]:
      0
[2]:
   [1]:
      -2
   [2]:
      1
   [3]:
      1
[3]:
   [1]:
      -2
   [2]:
      1
   [3]:
      1
[4]:
   [1]:
      -2
   [2]:
      -1
   [3]:
      1
[5]:
   [1]:
      2
   [2]:
      -2
   [3]:
      1
[6]:
   [1]:
      0
   [2]:
      0
   [3]:
      1</pre>
</div>
<p>Here is another way of doing this same calculation in the Sage
interface to Singular:</p>
<div class="highlight-python"><pre>sage: singular.LIB("brnoeth.lib")
sage: singular.ring(5,'(x,y)','lp')
    //   characteristic : 5
    //   number of vars : 2
    //        block   1 : ordering lp
    //                  : names    x y
    //        block   2 : ordering C
sage: f = singular('y^2-x^9-x')
sage: print singular.eval("list X1=Adj_div(%s);"%f.name())
Computing affine singular points ...
Computing all points at infinity ...
Computing affine singular places ...
Computing singular places at infinity ...
Computing non-singular places at infinity ...
Adjunction divisor computed successfully
&lt;BLANKLINE&gt;
The genus of the curve is 4
sage: print singular.eval("list X2=NSplaces(1,X1);")
Computing non-singular affine places of degree 1 ...
sage: print singular.eval("list X3=extcurve(1,X2);")
&lt;BLANKLINE&gt;
Total number of rational places : 6
&lt;BLANKLINE&gt;
sage: singular.eval("def R=X3[1][5];")
'def R=X3[1][5];'
sage: singular.eval("setring R;")
'setring R;'
sage: L = singular.eval("POINTS;")</pre>
</div>
<div class="highlight-python"><pre>sage: print L
[1]:
   [1]:
      0
   [2]:
      1
   [3]:
      0
[2]:
   [1]:
      2    # 32-bit
      -2   # 64-bit
   [2]:
      2    # 32-bit
      1    # 64-bit
   [3]:
      1
...</pre>
</div>
<p>From looking at the output, notice that our wrapper function will need
to parse the string represented by <span class="math">\(L\)</span> above, so let us write a
separate function to do just that. This requires figuring out how to
determine where the coordinates of the points are placed in the string
<span class="math">\(L\)</span>. Python has some very useful string manipulation commands to do
just that.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">points_parser</span><span class="p">(</span><span class="n">string_points</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will parse a string of points</span>
<span class="sd">    of X over a finite field F returned by Singular&#39;s NSplaces</span>
<span class="sd">    command into a Python list of points with entries from F.</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: F = GF(5)</span>
<span class="sd">        sage: points_parser(L,F)</span>
<span class="sd">        ((0, 1, 0), (3, 4, 1), (0, 0, 1), (2, 3, 1), (3, 1, 1), (2, 2, 1))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Pts</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="c">#print n</span>
    <span class="c">#start block to compute a pt</span>
    <span class="n">L1</span><span class="o">=</span><span class="n">L</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">32</span><span class="p">:</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;     &quot;</span><span class="p">)</span>
        <span class="n">pt</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">## start block1 for compute pt</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;     &quot;</span><span class="p">)</span>
        <span class="n">idx2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">L2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">idx2</span><span class="p">]</span>
        <span class="c">#print L2</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">L2</span><span class="p">)))</span>
        <span class="c"># end block1 to compute pt</span>
        <span class="n">L1</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">8</span><span class="p">:]</span> <span class="c"># repeat block 2 more times</span>
        <span class="c">#print len(L1)</span>
        <span class="c">## start block2 for compute pt</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;     &quot;</span><span class="p">)</span>
        <span class="n">idx2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">L2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">idx2</span><span class="p">]</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">L2</span><span class="p">)))</span>
        <span class="c"># end block2 to compute pt</span>
        <span class="n">L1</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">8</span><span class="p">:]</span> <span class="c"># repeat block 1 more time</span>
        <span class="c">## start block3 for compute pt</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;     &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="ow">in</span> <span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]:</span>
            <span class="n">idx2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx2</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:])</span>
        <span class="n">L2</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">idx2</span><span class="p">]</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">L2</span><span class="p">)))</span>
        <span class="c">#print pt</span>
        <span class="c"># end block3 to compute pt</span>
        <span class="c">#end block to compute a pt</span>
        <span class="n">Pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>  <span class="c"># repeat until no more pts</span>
        <span class="n">L1</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">8</span><span class="p">:]</span> <span class="c"># repeat block 2 more times</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Pts</span><span class="p">)</span>
</pre></div>
</div>
<p>Now it is an easy matter to put these ingredients together into a Sage
function which takes as input a triple <span class="math">\((f,F,d)\)</span>: a polynomial <span class="math">\(f\)</span> in
<span class="math">\(F[x,y]\)</span> defining <span class="math">\(X:\  f(x,y)=0\)</span> (note that the variables <span class="math">\(x,y\)</span> must
be used), a finite field <span class="math">\(F\)</span> <em>of prime order</em>, and the degree <span class="math">\(d\)</span>. The
output is the number of places in <span class="math">\(X\)</span> of degree <span class="math">\(d=1\)</span> over <span class="math">\(F\)</span>. At the
moment, there is no &#8220;translation&#8221; between elements of <span class="math">\(GF(p^d)\)</span> in
Singular and Sage unless <span class="math">\(d=1\)</span>. So, for this reason, we restrict
ourselves to points of degree one.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">places_on_curve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INPUT:</span>
<span class="sd">        f -- element of F[x,y], defining X: f(x,y)=0</span>
<span class="sd">        F -- a finite field of *prime order*</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">        integer -- the number of places in X of degree d=1 over F</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: F=GF(5)</span>
<span class="sd">        sage: R=PolynomialRing(F,2,names=[&quot;x&quot;,&quot;y&quot;])</span>
<span class="sd">        sage: x,y=R.gens()</span>
<span class="sd">        sage: f=y^2-x^9-x</span>
<span class="sd">        sage: places_on_curve(f,F)</span>
<span class="sd">        ((0, 1, 0), (3, 4, 1), (0, 0, 1), (2, 3, 1), (3, 1, 1), (2, 2, 1))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">characteristic</span><span class="p">()</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&#39;LIB &quot;brnoeth.lib&quot;;&#39;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;ring s=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;,(x,y),lp;&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;poly f=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;list X1=Adj_div(f);&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;list X2=NSplaces(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;,X1);&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;list X3=extcurve(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;,X2);&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;def R=X3[1][5];&quot;</span><span class="p">)</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;setring R;&quot;</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;POINTS;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">points_parser</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the ordering returned by this Sage function is exactly the
same as the ordering in the Singular variable <tt class="docutils literal"><span class="pre">POINTS</span></tt>.</p>
<p>One more example (in addition to the one in the docstring):</p>
<div class="highlight-python"><pre>sage: F = GF(2)
sage: R = MPolynomialRing(F,2,names = ["x","y"])
sage: x,y = R.gens()
sage: f = x^3*y+y^3+x
sage: places_on_curve(f,F)
((0, 1, 0), (1, 0, 0), (0, 0, 1))</pre>
</div>
</div>
<div class="section" id="singular-another-approach">
<h2>Singular: Another approach<a class="headerlink" href="#singular-another-approach" title="Permalink to this headline">¶</a></h2>
<p>There is also a more Python-like interface to Singular. Using this,
the code is much simpler, as illustrated below. First, we demonstrate
computing the places on a curve in a particular case.</p>
<div class="highlight-python"><pre>sage: singular.lib('brnoeth.lib')
sage: R = singular.ring(5, '(x,y)', 'lp')
sage: f = singular.new('y^2 - x^9 - x')
sage: X1 = f.Adj_div()
sage: X2 = singular.NSplaces(1, X1)
sage: X3 = singular.extcurve(1, X2)
sage: R = X3[1][5]
sage: singular.set_ring(R)
sage: L = singular.new('POINTS')</pre>
</div>
<p>Note that these elements of L are defined modulo 5 in Singular, and
they compare differently than you would expect from their print
representation:</p>
<div class="highlight-python"><pre>sage: sorted([(L[i][1], L[i][2], L[i][3]) for i in range(1,7)])
[(0, 0, 1), (0, 1, 0), (2, 2, 1), (2, -2, 1), (-2, 1, 1), (-2, -1, 1)]</pre>
</div>
<p>Next, we implement the general function (for brevity we omit the
docstring, which is the same as above). Note that the <tt class="docutils literal"><span class="pre">point_parser</span></tt>
function is not required.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">places_on_curve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">F</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">characteristic</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">F</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">lib</span><span class="p">(</span><span class="s">&#39;brnoeth.lib&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">ring</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">&#39;(x,y)&#39;</span><span class="p">,</span> <span class="s">&#39;lp&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;y^2 - x^9 - x&#39;</span><span class="p">)</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Adj_div</span><span class="p">()</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">NSplaces</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X1</span><span class="p">)</span>
    <span class="n">X3</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">extcurve</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">X3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">singular</span><span class="o">.</span><span class="n">setring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">singular</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;POINTS&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span> \
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<p>This code is much shorter, nice, and more readable. However, it
depends on certain functions, e.g. <tt class="docutils literal"><span class="pre">singular.setring</span></tt> having been
implemented in the Sage/Singular interface, whereas the code in the
previous section used only the barest minimum of that interface.</p>
</div>
<div class="section" id="creating-a-new-pseudo-tty-interface">
<h2>Creating a new pseudo-tty interface<a class="headerlink" href="#creating-a-new-pseudo-tty-interface" title="Permalink to this headline">¶</a></h2>
<p>You can create Sage pseudo-tty interfaces that allow Sage to work with
almost any command line program, and which do not require any
modification or extensions to that program. They are also surprisingly
fast and flexible (given how they work!), because all I/O is buffered,
and because interaction between Sage and the command line program can
be non-blocking (asynchronous). A pseudo-tty Sage interface is
asynchronous because it derives from the Sage class <tt class="docutils literal"><span class="pre">Expect</span></tt>, which
handles the communication between Sage and the external process.</p>
<p>For example, here is part of the file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/devel/sage/sage/interfaces/octave.py</span></tt>, which
defines an interface between Sage and Octave, an open source program
for doing numerical computations, among other things.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">expect</span> <span class="kn">import</span> <span class="n">Expect</span><span class="p">,</span> <span class="n">ExpectElement</span>

<span class="k">class</span> <span class="nc">Octave</span><span class="p">(</span><span class="n">Expect</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The first two lines import the library <tt class="docutils literal"><span class="pre">os</span></tt>, which contains
operating system routines, and also the class <tt class="docutils literal"><span class="pre">Expect</span></tt>, which is the
basic class for interfaces. The third line defines the class
<tt class="docutils literal"><span class="pre">Octave</span></tt>; it derives from <tt class="docutils literal"><span class="pre">Expect</span></tt> as well. After this comes a
docstring, which we omit here (see the file for details). Next comes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxread</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">script_subdirectory</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">server</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">server_tmpdir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">Expect</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;octave&#39;</span><span class="p">,</span>
                    <span class="n">prompt</span> <span class="o">=</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="s">&quot;octave --no-line-editing --silent&quot;</span><span class="p">,</span>
                    <span class="n">maxread</span> <span class="o">=</span> <span class="n">maxread</span><span class="p">,</span>
                    <span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="p">,</span>
                    <span class="n">server_tmpdir</span> <span class="o">=</span> <span class="n">server_tmpdir</span><span class="p">,</span>
                    <span class="n">script_subdirectory</span> <span class="o">=</span> <span class="n">script_subdirectory</span><span class="p">,</span>
                    <span class="n">restart_on_ctrlc</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="n">verbose_start</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span><span class="p">,</span>
                    <span class="n">eval_using_file_cutoff</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>This uses the class <tt class="docutils literal"><span class="pre">Expect</span></tt> to set up the Octave interface.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the variable var to the given value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Error executing code in Octave</span><span class="se">\n</span><span class="s">CODE:</span><span class="se">\n\t</span><span class="si">%s</span><span class="se">\n</span><span class="s">Octave ERROR:</span><span class="se">\n\t</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the value of the variable var.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">var</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">console</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">octave_console</span><span class="p">()</span>
</pre></div>
</div>
<p>These let users type <tt class="docutils literal"><span class="pre">octave.set('x',</span> <span class="pre">3)</span></tt>, after which
<tt class="docutils literal"><span class="pre">octave.get('x')</span></tt> returns <tt class="docutils literal"><span class="pre">'</span> <span class="pre">3'</span></tt>. Running <tt class="docutils literal"><span class="pre">octave.console()</span></tt>
dumps the user into an Octave interactive shell.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solve_linear_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use octave to compute a solution x to A*x = b, as a list.</span>

<span class="sd">    INPUT:</span>
<span class="sd">        A -- mxn matrix A with entries in QQ or RR</span>
<span class="sd">        b -- m-vector b entries in QQ or RR (resp)</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">        An list x (if it exists) which solves M*x = b</span>

<span class="sd">    EXAMPLES:</span>
<span class="sd">        sage: M33 = MatrixSpace(QQ,3,3)</span>
<span class="sd">        sage: A   = M33([1,2,3,4,5,6,7,8,0])</span>
<span class="sd">        sage: V3  = VectorSpace(QQ,3)</span>
<span class="sd">        sage: b   = V3([1,2,3])</span>
<span class="sd">        sage: octave.solve_linear_system(A,b)    # optional - octave</span>
<span class="sd">        [-0.33333299999999999, 0.66666700000000001, -3.5236600000000002e-18]</span>

<span class="sd">    AUTHOR: David Joyner and William Stein</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">nrows</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">ncols</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;dimensions of A and b must be compatible&quot;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">sage.matrix.all</span> <span class="kn">import</span> <span class="n">MatrixSpace</span>
    <span class="kn">from</span> <span class="nn">sage.rings.all</span> <span class="kn">import</span> <span class="n">QQ</span>
    <span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">b</span>  <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="c"># converted b to a &quot;column vector&quot;</span>
    <span class="n">sA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sage2octave_matrix_string</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sage2octave_matrix_string</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;a = &quot;</span> <span class="o">+</span> <span class="n">sA</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;b = &quot;</span> <span class="o">+</span> <span class="n">sb</span> <span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">octave</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s">&quot;c = a </span><span class="se">\\</span><span class="s"> b&quot;</span><span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s"> &quot;</span><span class="p">,</span><span class="s">&quot;[&quot;</span><span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;]&quot;</span><span class="p">)</span>
    <span class="n">soln</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">sol</span>  <span class="o">=</span> <span class="n">soln</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
<p>This code defines the method <tt class="docutils literal"><span class="pre">solve_linear_system</span></tt>, which works as
documented.</p>
<p>These are only excerpts from <tt class="docutils literal"><span class="pre">octave.py</span></tt>; check that file for more
definitions and examples. Look at other files in the directory
<tt class="docutils literal"><span class="pre">SAGE_ROOT/devel/sage/sage/interfaces/</span></tt> for examples of interfaces
to other software packages.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[3]</a></td><td>See <a class="reference external" href="http://www.sagemath.org/links-components.html">http://www.sagemath.org/links-components.html</a> for a list</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Coding using external libraries and interfaces</a><ul>
<li><a class="reference internal" href="#the-pari-c-library-interface">The PARI C library interface</a></li>
<li><a class="reference internal" href="#gap">GAP</a></li>
<li><a class="reference internal" href="#singular">Singular</a></li>
<li><a class="reference internal" href="#singular-another-approach">Singular: Another approach</a></li>
<li><a class="reference internal" href="#creating-a-new-pseudo-tty-interface">Creating a new pseudo-tty interface</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="coding_in_cython.html"
                                  title="previous chapter">Coding in Cython</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="doctesting.html"
                                  title="next chapter">Doctesting the Sage Library</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/coding_in_other.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="doctesting.html" title="Doctesting the Sage Library"
             >next</a> |</li>
        <li class="right" >
          <a href="coding_in_cython.html" title="Coding in Cython"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v6.0</a> &raquo;</li>

          <li><a href="writing_code.html" >Writing Code for Sage</a> &raquo;</li> 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2005--2011, The Sage Development Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;  
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');
    
    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });
    
    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();
    
    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };
    
    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });
    
    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>